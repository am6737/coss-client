import{r as n,j as s,P as S,N as k,o as L,a as N,$ as e,L as g,f as r,U as h,C as l,m as U}from"./index-Co9Jrsve.js";import{L as i}from"./list-input-C_1uFysw.js";import{a as B}from"./validate-6tRYFLtu.js";const D=({f7route:m,f7router:x})=>{const{default:d,title:y}=m.query,u=m.params.type,[c,b]=n.useState(d),[w,v]=n.useState(""),[o,j]=n.useState(""),[p,I]=n.useState(""),P=async()=>{try{r.dialog.preloader(e("修改中..."));const a={[u]:c},{data:t}=await h.updateUserInfoApi(a),f=await l.findOneById(l.tables.users,"user_id",t==null?void 0:t.user_id);f&&await l.update(l.tables.users,"user_id",t==null?void 0:t.user_id,{...f,user_info:{...f.user_info,...a}}),x.back()}catch(a){console.error("更新用户信息失败",a),r.dialog.alert(e("更新用户信息失败"))}finally{r.dialog.close()}},_=async()=>{if(!w||!o||!p)return r.dialog.alert(e("内容不能留空"));if(o!==p)return r.dialog.alert(e("两次密码不一致"));if(!B(o))return r.dialog.alert(e("新密码强度太弱"));try{r.dialog.preloader(e("修改中..."));const{code:a,msg:t}=await h.updatePassWordApi({old_password:w,password:o,confirm_password:p});if(a!==200)throw new Error(t);r.dialog.alert(e("修改密码成功"),e("请重新登录"),()=>{U(),location.reload()})}catch(a){r.dialog.alert(a.message||e("修改密码失败"))}finally{r.dialog.close()}},C=async()=>{if(u==="password")return await _();if(c===d||!c)return r.dialog.alert(e("请输入修改内容"));await P()};return s.jsxs(S,{noToolbar:!0,className:"bg-bgTertiary",children:[s.jsx(k,{className:"hidden-navbar-bg",backLink:!0,title:y,children:s.jsx(L,{children:s.jsx(N,{onClick:()=>C(),children:e("完成")})})}),u!=="password"?s.jsx(g,{strongIos:!0,outlineIos:!0,dividersIos:!0,form:!0,formStoreData:!0,children:s.jsx(i,{name:"name",type:"text",onChange:a=>b(a.target.value),clearButton:!0,defaultValue:d,autofocus:!0})}):s.jsxs(g,{strongIos:!0,outlineIos:!0,dividersIos:!0,form:!0,formStoreData:!0,children:[s.jsx(i,{label:e("旧密码"),name:"old_password",type:"password",onChange:a=>v(a.target.value),clearButton:!0,placeholder:e("请输入旧密码")}),s.jsx(i,{label:e("新密码"),name:"new_password",type:"password",onChange:a=>j(a.target.value),clearButton:!0,placeholder:e("请输入新密码")}),s.jsx(i,{label:e("确认密码"),name:"confirm_password",type:"password",onChange:a=>I(a.target.value),clearButton:!0,placeholder:e("请再次输入新密码")})]})]})};export{D as default};

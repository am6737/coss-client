import{r as d,g as C,h as E,i as w,R as b,V as J,Q as ge,X as be,f as c,Z as K,_ as j,j as r,P as xe,N as ve,$ as i,o as je,b as ye,L as N,l as y,ae as _e,af as Oe,ad as Ne,q as Y}from"./index-Co9Jrsve.js";function H(){return H=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},H.apply(this,arguments)}const ee=d.forwardRef((t,e)=>{const{className:o,id:n,style:f,children:m,padding:p=!0}=t,a=C(t),s=d.useRef(null);d.useImperativeHandle(e,()=>({el:s.current}));const h=E(o,"card-content",{"card-content-padding":p},w(t));return b.createElement("div",H({id:n,style:f,className:h,ref:s},a),m)});ee.displayName="f7-card-content";const x=ee;function L(){return L=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},L.apply(this,arguments)}const te=d.forwardRef((t,e)=>{const{className:o,id:n,style:f,children:m}=t,p=C(t),a=d.useRef(null);d.useImperativeHandle(e,()=>({el:a.current}));const s=E(o,"card-footer",w(t));return b.createElement("div",L({id:n,style:f,className:s,ref:a},p),m)});te.displayName="f7-card-footer";const Ce=te;function G(){return G=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},G.apply(this,arguments)}const ae=d.forwardRef((t,e)=>{const{className:o,id:n,style:f,children:m}=t,p=C(t),a=d.useRef(null);d.useImperativeHandle(e,()=>({el:a.current}));const s=E(o,"card-header",w(t));return b.createElement("div",G({id:n,style:f,className:s,ref:a},p),m)});ae.displayName="f7-card-header";const Ee=ae;function T(){return T=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},T.apply(this,arguments)}const re=d.forwardRef((t,e)=>{const{className:o,id:n,style:f,title:m,content:p,footer:a,padding:s,raised:h,outline:R,outlineIos:ne,outlineMd:se,headerDivider:oe,footerDivider:ce,expandable:O,expandableAnimateWidth:le,expandableOpened:D,animate:S,hideNavbarOnOpen:I,hideToolbarOnOpen:k,hideStatusbarOnOpen:P,scrollableEl:de,swipeToClose:$,closeByBackdropClick:A,backdrop:B,backdropEl:ie}=t,ue=C(t),u=d.useRef(null),F=()=>{u.current&&c.card.open(u.current)},M=()=>{u.current&&c.card.close(u.current)},V=(l,v)=>{u.current===l&&j(t,"cardBeforeOpen",l,v)},X=l=>{u.current===l&&j(t,"cardOpen",l)},q=(l,v)=>{u.current===l&&j(t,"cardOpened",l,v)},Q=l=>{u.current===l&&j(t,"cardClose",l)},U=(l,v)=>{u.current===l&&j(t,"cardClosed",l,v)},fe=()=>{!O||!u.current||K(()=>{c.on("cardBeforeOpen",V),c.on("cardOpen",X),c.on("cardOpened",q),c.on("cardClose",Q),c.on("cardClosed",U)})},me=()=>{c.off("cardBeforeOpen",V),c.off("cardOpen",X),c.off("cardOpened",q),c.off("cardClose",Q),c.off("cardClosed",U)},pe=()=>{!O||!u.current||K(()=>{O&&D&&c.card.open(u.current,!1)})};J(()=>{pe()},[]),J(()=>(fe(),me)),ge(D,l=>{l?F():M()}),d.useImperativeHandle(e,()=>({el:u.current,open:F,close:M}));let W,Z,z;const he=E(o,"card",{"card-raised":h,"card-header-divider":oe,"card-footer-divider":ce,"card-outline":R,"card-outline-ios":ne,"card-outline-md":se,"card-expandable":O,"card-expandable-animate-width":le},w(t)),g=be(t);return(m||g.header)&&(W=b.createElement(Ee,null,m,g.header)),(p||g.content)&&(Z=b.createElement(x,{padding:s},p,g.content)),(a||g.footer)&&(z=b.createElement(Ce,null,a,g.footer)),b.createElement("div",T({id:n,style:f,className:he,"data-animate":typeof S>"u"?S:S.toString(),"data-hide-navbar-on-open":typeof I>"u"?I:I.toString(),"data-hide-toolbar-on-open":typeof k>"u"?k:k.toString(),"data-hide-statusbar-on-open":typeof P>"u"?P:P.toString(),"data-scrollable-el":de,"data-swipe-to-close":typeof $>"u"?$:$.toString(),"data-close-by-backdrop-click":typeof A>"u"?A:A.toString(),"data-backdrop":typeof B>"u"?B:B.toString(),"data-backdrop-el":ie,ref:u},ue),W,Z,z,g.default)});re.displayName="f7-card";const _=re,Re=({f7router:t})=>{const[e,o]=d.useState({name:"",avatar:"https://cdn.framework7.io/placeholder/nature-1000x600-3.jpg",type:0,max_members_limit:100,member:[]}),[n,f]=d.useState([]),[m]=d.useState([100,500,1e3]),p=async()=>{try{c.dialog.preloader("创建中...");const{code:a,data:s,msg:h}=await Ne.createGroupApi(e);if(a!==200){c.dialog.alert(h,i("新建群聊失败"));return}const R={dialog_id:s==null?void 0:s.dialog_id,group_id:s==null?void 0:s.id,dialog_type:s==null?void 0:s.type,dialog_name:s==null?void 0:s.name,dialog_avatar:s==null?void 0:s.avatar,dialog_unread_count:0,last_message:{msg_type:0,content:"",sender_id:"",send_time:0,msg_id:0},dialog_create_at:Date.now(),top_at:0};await Y.add(Y.tables.dialogs,R),t.back()}catch(a){console.error("创建群聊失败",a),c.dialog.alert(i("群聊创建失败"))}finally{c.dialog.close()}};return d.useEffect(()=>{if(!n.length)return;const a=n.map(s=>s.user_id);o({...e,member:a})},[n]),r.jsxs(xe,{noToolbar:!0,className:"bg-bgTertiary relative",children:[r.jsx(ve,{backLink:!0,title:i("新建群聊"),className:"bg-bgPrimary hidden-navbar-bg",children:r.jsx(je,{children:r.jsx(ye,{large:!0,disabled:!e.name,onClick:p,children:i("完成")})})}),r.jsx(_,{title:i("群头像和群名称"),className:"coss_card_title",children:r.jsxs(x,{className:"flex justify-center flex-col items-center",children:[r.jsx("img",{className:"w-20 h-20 rounded-full mb-5",src:e.avatar}),r.jsx("input",{className:"text-center bg-transparent",placeholder:i("请输入群名称"),name:"name",value:e.name,onChange:a=>o({...e,name:a.target.value})})]})}),r.jsx(_,{title:i("群类型"),className:"coss_card_title",children:r.jsx(x,{children:r.jsxs(N,{strongIos:!0,dividersIos:!0,children:[r.jsx(y,{radio:!0,radioIcon:"end",defaultChecked:e.type==1,name:"type",value:"1",onChange:a=>o({...e,type:Number(a.target.value)}),children:r.jsx("span",{slot:"title",className:"text-base",children:i("公开")})}),r.jsx(y,{radio:!0,radioIcon:"end",defaultChecked:e.type==0,name:"type",value:"0",onChange:a=>o({...e,type:Number(a.target.value)}),children:r.jsx("span",{slot:"title",className:"text-base",children:i("私有")})})]})})}),r.jsx(_,{title:i("群人数"),className:"coss_card_title",children:r.jsx(x,{children:r.jsx(N,{strongIos:!0,outlineIos:!0,dividersIos:!0,children:r.jsx(y,{title:i("该群最大人数"),smartSelect:!0,smartSelectParams:{openIn:"sheet",sheetCloseLinkText:i("完成")},children:r.jsx("select",{name:"number",defaultValue:e.max_members_limit,onChange:a=>o({...e,max_members_limit:Number(a.target.value)}),children:m.map((a,s)=>r.jsx("option",{value:a,children:a},s))})})})})}),r.jsx(_,{title:i("群成员"),className:"coss_card_title",children:r.jsx(x,{padding:!1,children:r.jsx(N,{children:r.jsx(y,{link:!0,popupOpen:".contact-popup",children:i("从好友列表选取")})})})}),r.jsx(_,{title:n.length&&i("已选择"),className:"coss_card_title",children:r.jsx(x,{padding:!1,children:r.jsx(N,{children:n.map((a,s)=>r.jsxs(y,{link:!0,noChevron:!0,title:a==null?void 0:a.nickname,children:[r.jsx("img",{slot:"media",src:a==null?void 0:a.avatar,alt:"",className:"w-12 h-12 rounded-full object-cover"}),r.jsx(_e,{slot:"after",onClick:()=>f(n.filter(h=>h!==a))})]},s))})})}),r.jsx(Oe,{completed:f,defaults:n})]})};export{Re as default};

import{r as h,X as N,j as n,P as b,N as C,$ as o,x as S,a as $,aD as w,I as k,aj as _,f as i}from"./index-BMnTsVIf.js";import{C as A,a as D}from"./card-DOTaUnGT.js";var f=["second","minute","hour","day","week","month","year"];function I(e,t){if(t===0)return["just now","right now"];var r=f[Math.floor(t/2)];return e>1&&(r+="s"),[e+" "+r+" ago","in "+e+" "+r]}var P=["秒","分钟","小时","天","周","个月","年"];function E(e,t){if(t===0)return["刚刚","片刻后"];var r=P[~~(t/2)];return[e+" "+r+"前",e+" "+r+"后"]}var p={},y=function(e,t){p[e]=t},G=function(e){return p[e]||p.en_US},x=[60,60,24,7,365/7/12,12];function m(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(parseInt(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(e))}function L(e,t){var r=e<0?1:0;e=Math.abs(e);for(var l=e,s=0;e>=x[s]&&s<x.length;s++)e/=x[s];return e=Math.floor(e),s*=2,e>(s===0?9:1)&&(s+=1),t(e,s,l)[r].replace("%s",e.toString())}function U(e,t){var r=t?m(t):new Date;return(+r-+m(e))/1e3}var z=function(e,t,r){var l=U(e,r&&r.relativeDate);return L(l,G(t))};y("en_US",I);y("zh_CN",E);const T=({f7route:e,f7router:t})=>{var g;const r=e.params.group_id,l=h.useMemo(()=>{var a,c;return(a=e==null?void 0:e.query)!=null&&a.identity?parseInt((c=e==null?void 0:e.query)==null?void 0:c.identity)===2:!1},[(g=e==null?void 0:e.query)==null?void 0:g.identity]),[s,j]=h.useState(null),d=async()=>{const a=await _.groupAnnouncementApi({group_id:r});return j(a.data),(a==null?void 0:a.data)||[]};N(async()=>{d()},()=>{},[]);const v=async a=>{i.dialog.confirm(o("是否确认删除群公告?"),o("删除"),async()=>{try{const{code:c,msg:u}=await _.deleteGroupAnnouncementApi({group_id:parseInt(r),id:a});if(c!==200){i.dialog.alert(o(u||"删除群公告失败"));return}c===200&&d()}catch(c){return i.dialog.alert(o((c==null?void 0:c.message)||"删除群公告失败"))}finally{i.dialog.close()}})};return n.jsxs(b,{noToolbar:!0,className:"bg-bgTertiary",onPageBeforeIn:d,children:[n.jsx(C,{title:o("群公告"),backLink:!0,className:"bg-bgPrimary",children:n.jsx(S,{children:l&&n.jsx($,{href:`/create_group_notice/${r}/?admin=${l}`,className:"text-2xl",children:n.jsx(w,{})})})}),s?s.map((a,c)=>n.jsx(A,{className:"coss_card_title m-3",children:n.jsx(D,{className:"flex justify-center flex-col",children:n.jsxs("div",{onClick:()=>t.navigate(`/create_group_notice/${r}/?id=${a.id}&admin=${l}`),children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("div",{className:"text-textPrimary text-base font-bold line-clamp-1 break-all",children:a.title}),l&&n.jsx("div",{onClick:u=>{u.stopPropagation(),v(a.id)},children:n.jsx(k,{className:"m-2",f7:"xmark_circle",size:18})})]}),n.jsx("div",{className:"my-2 text-textSecondary text-sm line-clamp-2 break-all",children:a.content}),n.jsxs("div",{className:"text-xs text-gray-400 flex justify-between items-center",children:[n.jsx("span",{className:"",children:z(a!=null&&a.updated_at?a==null?void 0:a.updated_at:a==null?void 0:a.created_at,"zh_CN")}),n.jsxs("span",{children:[a.read_user_list?a.read_user_list.length:0,"人已读"]})]})]})})},c)):n.jsx("p",{className:"text-center pt-5 text-textSecondary",children:o("暂无公告")})]})};export{T as default};

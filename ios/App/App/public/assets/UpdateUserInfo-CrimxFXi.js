import{u as k,r as t,j as r,P as I,N,x as A,a as E,$ as a,f as e,U as g,q}from"./index-BMnTsVIf.js";import{a as L}from"./validate-6tRYFLtu.js";import{C as d}from"./CommInput-DSDBNgKN.js";const $=({f7route:u,f7router:m})=>{const{default:l,title:h}=u.query,n=u.params.type,f=k(),[i,x]=t.useState(l),[w,y]=t.useState(""),[o,j]=t.useState(""),[c,P]=t.useState(""),v=async()=>{try{e.dialog.preloader(a("修改中..."));const s={[n]:i},{code:p,data:U,msg:b}=await g.updateUserInfoApi(s);if(p!==200)return e.dialog.alert(a(b));f.update({userInfo:{...f.userInfo,...U}}),m.back()}catch(s){console.error("更新用户信息失败",s),e.dialog.alert(a("更新用户信息失败"))}finally{e.dialog.close()}},C=async()=>{if(!w||!o||!c)return e.dialog.alert(a("内容不能留空"));if(o!==c)return e.dialog.alert(a("两次密码不一致"));if(!L(o))return e.dialog.alert(a("新密码强度太弱"));try{e.dialog.preloader(a("修改中..."));const{code:s,msg:p}=await g.updatePassWordApi({old_password:w,password:o,confirm_password:c});if(s!==200)throw new Error(p);e.dialog.alert(a("修改密码成功"),a("请重新登录"),()=>{q(),location.reload()})}catch(s){e.dialog.alert(s.message||a("修改密码失败"))}finally{e.dialog.close()}},S=async()=>{if(n==="password")return await C();if(i===l||!i)return e.dialog.alert(a("请输入修改内容"));await v()};return r.jsxs(I,{noToolbar:!0,children:[r.jsx(N,{className:"hidden-navbar-bg",backLink:!0,title:h,children:r.jsx(A,{children:r.jsx(E,{onClick:()=>S(),children:a("完成")})})}),n!=="password"?r.jsx("div",{children:r.jsx(d,{defaultValue:l,onChange:s=>x(s)})}):r.jsxs("div",{children:[r.jsx(d,{title:a("旧密码"),placeholder:a("请输入旧密码"),type:"password",onChange:s=>y(s)}),r.jsx(d,{title:a("新密码"),placeholder:a("请输入新密码"),type:"password",onChange:s=>j(s)}),r.jsx(d,{title:a("确认密码"),placeholder:a("请再次输入新密码"),type:"password",onChange:s=>P(s)})]})]})};export{$ as default};

import{z as H,E as J,F as Q,r as z,G as V,M as g,j as a,P as W,N as X,$ as c,n as Z,a as Y,I as $,L as M,m as x,H as h,J as f,U as I,K as R,O as o,p as l}from"./index-BMnTsVIf.js";import{L as T}from"./list-button-Wa9Up56A.js";import{T as j}from"./toggle-C_Wfo19x.js";const N=[{label:c("10秒"),value:10},{label:c("1分钟"),value:60},{label:c("10分钟"),value:600}],te=({f7route:y,f7router:b})=>{var L,w,B,E;const n=y.params.user_id,F=y.query.from_page==="message",v=Number(y.query.dialog_id)??0,C=H(),_=J(),S=Q(),[e,k]=z.useState(),{watchAsyncFn:d}=V(),P=async()=>{var s;try{const i=(s=_.cacheContacts)==null?void 0:s.find(t=>(t==null?void 0:t.user_id)===n);k(i),I.getUserInfoApi({user_id:n}).then(({code:t,data:r})=>{if(t!==200)return;const m={...i,...r};k(m),p({},m)})}catch(i){console.error("onPageBeforeIn",i)}},p=(s={},i={})=>{var m;const t={...e,preferences:{...e==null?void 0:e.preferences,...s},...i};k(t);const r=(m=_.cacheContacts)==null?void 0:m.map(u=>(u==null?void 0:u.user_id)===n?t:u);_.updateCacheContactsObj(r)},O=async()=>{R("是否确认删除好友","删除好友",async()=>{d(async()=>{var s;try{const{code:i}=await o.deleteFriendApi(n);if(i!==200){l("删除好友失败");return}const t=(s=_.cacheContacts)==null?void 0:s.filter(r=>(r==null?void 0:r.user_id)!==n);_.updateCacheContactsObj(t)}catch{l("删除好友失败")}finally{b.back()}},"删除中...")})},G=async()=>{R("是否确认删除所有聊天记录","删除聊天记录",async()=>{d(async()=>{try{await S.deleteAllMessage(v),l("删除聊天记录成功")}catch{l("删除聊天记录失败")}},"删除中...")})},K=async()=>{var t;const s=((t=e==null?void 0:e.preferences)==null?void 0:t.open_burn_after_reading)===g.YES?g.NO:g.YES,i=s===g.YES?c("阅后即焚失败"):c("取消阅后即焚失败");d(async()=>{try{const{code:r}=await o.setBurnApi({action:s,user_id:n});if(r!==200){l(i);return}await o.setBurnTimeApi({friend_id:n,open_burn_after_reading_time_out:10}),p({open_burn_after_reading_time_out:10,open_burn_after_reading:s})}catch{l("设置阅后即焚失败")}},"设置中...")},U=async()=>{var t;const s=((t=e==null?void 0:e.preferences)==null?void 0:t.silent_notification)===h.YES?h.NO:h.YES,i=s===h.YES?c("消息免打扰失败"):c("取消消息免打扰失败");d(async()=>{try{const{code:r}=await o.setSilenceApi({is_silent:s,user_id:n});if(r!==200){l(i);return}p({silent_notification:s})}catch{l("设置消息免打扰失败")}},"设置消息免打扰中...")},D=async()=>{const s=(e==null?void 0:e.relation_status)===f.BLACK,i=s?c("移除黑名单失败"):c("添加黑名单失败");d(async()=>{try{const t={user_id:n},{code:r}=s?await o.deleteBlackListApi(t):await o.addBlackListApi(t);if(r!==200)return l(i);p({},{relation_status:s?f.YES:f.BLACK})}catch{l(i)}},s?"移除黑名单中...":"加入黑名单中...")},q=async s=>{d(async()=>{try{const{code:i}=await o.setBurnTimeApi({friend_id:n,open_burn_after_reading_time_out:N[s].value});if(i!==200)return l("设置失败");p({open_burn_after_reading_time_out:N[s].value})}catch{l("设置失败")}},"设置中...")},A=z.useMemo(()=>{var s;return((s=e==null?void 0:e.preferences)==null?void 0:s.open_burn_after_reading)===g.YES},[(L=e==null?void 0:e.preferences)==null?void 0:L.open_burn_after_reading]);return a.jsxs(W,{className:"profile-page bg-bgTertiary",noToolbar:!0,onPageBeforeIn:P,children:[a.jsx(X,{title:c("用户信息"),backLink:!0,className:"bg-bgPrimary hidden-navbar-bg"}),a.jsxs("div",{className:"mb-3 p-4 bg-white flex flex-col justify-center items-center",children:[a.jsx(Z,{size:70,src:e==null?void 0:e.avatar}),a.jsxs("div",{className:"mb-2 flex flex-col items-center",children:[a.jsx("span",{className:"",children:`@${(e==null?void 0:e.nickname)||""}`}),a.jsx("span",{className:"",children:`${(e==null?void 0:e.email)||""}`})]}),a.jsxs("div",{className:"flex my-4 justify-evenly w-full",children:[!F&&a.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",children:[a.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:a.jsx(Y,{iconF7:"chat_bubble_fill",iconSize:22,onClick:async()=>{await S.init({dialogId:v??0,receiverId:n??0,isGroup:!1,receiverInfo:{dialog_id:e==null?void 0:e.dialog_id,dialog_avatar:e==null?void 0:e.avatar,dialog_name:e==null?void 0:e.nickname}}),console.log(e),b==null||b.navigate(`/message/${n}/${v}/?is_group=false&dialog_name=${e.nickname}`)}})}),a.jsx("span",{className:"text-xs",children:"消息"})]}),a.jsxs("div",{className:"size-10 flex flex-col justify-center items-center",onClick:()=>C.call({recipient:n,isGroup:!1,video:!1}),children:[a.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:a.jsx($,{f7:"phone_fill",size:22})}),a.jsx("span",{className:"text-xs",children:"语音"})]}),a.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",onClick:()=>C.call({recipient:n,isGroup:!1,video:!0}),children:[a.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:a.jsx($,{f7:"videocam_fill",size:22})}),a.jsx("span",{className:"text-xs",children:"视频"})]}),a.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",onClick:()=>{},children:[a.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:a.jsx(Y,{iconF7:"tag_fill",iconSize:22})}),a.jsx("span",{className:"text-xs",children:"标注"})]})]})]}),a.jsxs(M,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:[a.jsx(x,{link:`/user_remark/?remark=${(w=e==null?void 0:e.preferences)==null?void 0:w.remark}&user_id=${e==null?void 0:e.user_id}`,title:c("备注"),after:(B=e==null?void 0:e.preferences)==null?void 0:B.remark}),a.jsx(x,{title:c("阅后即焚"),children:a.jsx(j,{slot:"after",checked:A,onChange:K})}),A&&a.jsx("li",{children:a.jsx("ul",{children:N.map((s,i)=>{var t;return a.jsx(x,{title:s.label,children:a.jsx(j,{slot:"after",onChange:()=>q(i),checked:s.value===(((t=e==null?void 0:e.preferences)==null?void 0:t.open_burn_after_reading_time_out)??10)})},i)})})}),a.jsx(x,{title:c("消息免打扰"),children:a.jsx(j,{slot:"after",checked:((E=e==null?void 0:e.preferences)==null?void 0:E.silent_notification)===h.YES,onChange:U})}),a.jsx(x,{title:c("添加到黑名单"),children:a.jsx(j,{slot:"after",checked:(e==null?void 0:e.relation_status)===f.BLACK,onChange:D})})]}),a.jsxs(M,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:[a.jsx(T,{color:"red",onClick:G,children:c("清除聊天记录")}),a.jsx(T,{color:"red",title:c("删除好友"),onClick:O})]})]})};export{te as default};

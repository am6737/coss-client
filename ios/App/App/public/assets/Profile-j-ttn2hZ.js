import{v as D,e as K,r as h,w as O,x as H,y as z,j as i,P as G,N as J,$ as a,L as y,l as f,a as x,M as g,z as p,E as _,q as r,U as Q,F as V,f as t,G as m}from"./index-Co9Jrsve.js";import{L as A}from"./list-button-U80JxM2j.js";import{T as j}from"./toggle-Bw0qqYWm.js";const W=D(K)||"",ee=({f7route:b,f7router:L})=>{var E,v;const c=b.params.user_id,N=b.query.from_page==="message",w=h.useRef({el:null}),S=h.useRef(null),[e,k]=h.useState({}),{updateContacts:C}=O(),{clearMessages:Y}=H(),R=async()=>{const s=S.current.offsetHeight;w.current.el.querySelector(".page-content").scrollTop=s/2,await u(!0)},u=async(s=!0)=>{const o=await r.findOneById(r.tables.friends,"user_id",c);if(k(o),!s)return;const{data:n}=await Q.getUserInfoApi({user_id:c}),l={...o,...n};V(o,l)||(k(l),await r.update(r.tables.friends,"user_id",c,l))},{call:B}=z(),U=async()=>{try{t.dialog.preloader(a("呼叫中...")),await B({userInfo:e})}catch(s){t.dialog.alert(a((s==null?void 0:s.message)||"呼叫失败..."))}finally{t.dialog.close()}},F=async()=>{t.dialog.confirm(a("是否确认删除好友?"),a("删除好友"),async()=>{try{t.dialog.preloader(a("删除中..."));const{code:s}=await m.deleteFriendApi(c);if(s!==200)return t.dialog.alert(a("删除好友失败"));C(!0),await r.delete(r.tables.friends,"user_id",c)}catch(s){return console.log("删除好友失败",s),t.dialog.alert(a("删除好友失败"))}finally{t.dialog.close(),L.back()}})},M=async()=>{t.dialog.confirm(a("是否确认删除所有聊天记录?"),a("删除聊天记录"),async()=>{try{t.dialog.preloader(a("删除中...")),await r.delete(r.tables.messages,"dialog_id",e.dialog_id),await Y(),t.dialog.alert(a("删除聊天记录成功"))}catch{return t.dialog.alert(a("删除聊天记录失败"))}finally{t.dialog.close()}})},P=async()=>{var l;const s=((l=e==null?void 0:e.preferences)==null?void 0:l.open_burn_after_reading)===g.YES?g.NO:g.YES,o=s===g.YES?a("是否确认阅后即焚?"):a("是否确认取消阅后即焚?"),n=s===g.YES?a("阅后即焚失败"):a("取消阅后即焚失败");t.dialog.confirm(o,a("阅后即焚"),async()=>{try{t.dialog.preloader(a("设置中..."));const{code:d}=await m.setBurnApi({action:s,user_id:c});if(d!==200)return t.dialog.alert(n);await r.update(r.tables.friends,"user_id",c,{preferences:{...e==null?void 0:e.preferences,open_burn_after_reading:s}}),await u(!1)}catch{return t.dialog.alert(n)}finally{t.dialog.close()}})},T=async()=>{var l;const s=((l=e==null?void 0:e.preferences)==null?void 0:l.silent_notification)===p.YES?p.NO:p.YES,o=s===p.YES?a("是否确认消息免打扰?"):a("是否确认取消消息免打扰?"),n=s===p.YES?a("消息免打扰失败"):a("取消消息免打扰失败");t.dialog.confirm(o,a("消息免打扰"),async()=>{try{t.dialog.preloader(a("消息免打扰中..."));const{code:d}=await m.setSilenceApi({is_silent:s,user_id:c});if(d!==200)return t.dialog.alert(n);await r.update(r.tables.friends,"user_id",c,{preferences:{...e==null?void 0:e.preferences,silent_notification:s}}),await u(!1)}catch{return t.dialog.alert(n)}finally{t.dialog.close()}})},$=async()=>{var l;const s=((l=e==null?void 0:e.preferences)==null?void 0:l.blacklist)===_.BLACK,o=s?a("是否确认取消添加到黑名单?"):a("是否确认添加到黑名单?"),n=s?a("移除黑名单失败"):a("添加黑名单失败");t.dialog.confirm(o,a("加入黑名单"),async()=>{try{t.dialog.preloader(a("加入黑名单中..."));const d={friend_id:c,user_id:W},{code:q}=s?await m.deleteBlackListApi(d):await m.addBlackListApi(d);if(q!==200)return t.dialog.alert(n);await r.update(r.tables.friends,"user_id",c,{preferences:{...e==null?void 0:e.preferences,blacklist:s?_.YES:_.BLACK}}),await u(!1)}catch{return t.dialog.alert(n)}finally{t.dialog.close()}})};return i.jsxs(G,{ref:w,className:"profile-page bg-bgTertiary",noToolbar:!0,onPageInit:R,children:[i.jsx(J,{title:a("用户信息"),backLink:!0,className:"bg-bgPrimary hidden-navbar-bg"}),i.jsx("div",{className:"profile-avatar-block",ref:S,children:i.jsx("img",{src:e==null?void 0:e.avatar,alt:""})}),i.jsxs("div",{className:"profile-content bg-gray-100",children:[i.jsxs(y,{strong:!0,outline:!0,dividers:!0,mediaList:!0,className:"no-margin-top m-0 mb-3 bg-white",children:[i.jsx(f,{title:e==null?void 0:e.name,text:e==null?void 0:e.nickname,children:!N&&i.jsxs("div",{slot:"after",className:"profile-actions-links",children:[i.jsx(x,{iconF7:"chat_bubble_fill",href:`/message/${b.params.id}/${e==null?void 0:e.dialog_id}/?is_group=false&dialog_name=${e==null?void 0:e.nickname}`}),i.jsx(x,{iconF7:"camera_fill"}),i.jsx(x,{iconF7:"phone_fill",onClick:U})]})}),i.jsx(f,{subtitle:e==null?void 0:e.signature,text:e==null?void 0:e.email})]}),i.jsxs(y,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:[i.jsx(f,{title:a("阅后即焚"),children:i.jsx(j,{slot:"after",checked:((E=e==null?void 0:e.preferences)==null?void 0:E.open_burn_after_reading)===g.YES,onChange:P})}),i.jsx(f,{title:a("消息免打扰"),children:i.jsx(j,{slot:"after",checked:((v=e==null?void 0:e.preferences)==null?void 0:v.silent_notification)===p.YES,onChange:T})}),i.jsx(f,{title:a("添加到黑名单"),children:i.jsx(j,{slot:"after",checked:(e==null?void 0:e.relation_status)===_.BLACK,onChange:$})})]}),i.jsxs(y,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:[i.jsx(A,{color:"red",onClick:M,children:a("清除聊天记录")}),i.jsx(A,{color:"red",title:a("删除好友"),onClick:F})]})]})]})};export{ee as default};

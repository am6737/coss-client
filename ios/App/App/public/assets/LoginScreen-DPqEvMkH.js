import{r as o,j as s,P as T,B as b,$ as t,L,c as v,t as E,a as q,b as B,d as M,D as U,U as F,f as N,C as i,s as d,e as O,A as D,T as R}from"./index-Co9Jrsve.js";import{L as y}from"./list-input-C_1uFysw.js";import{C as $,L as z,A as K,a as G,c as H}from"./Auth-B4_-bVHL.js";import{v as J}from"./validate-6tRYFLtu.js";import"./tweetnacl-BKT0x-TO.js";const Z=({f7router:S,defaultData:l})=>{const[a,c]=o.useState({email:"123@qq.com",password:"123456qq"}),[f,u]=o.useState(""),[x,p]=o.useState(""),[g,h]=o.useState(!1),k=()=>{let r=!1;return g?r:a.email.trim()?J(a.email.trim())?a.password.trim()?(r=!0,h(!0),r):(p(t("密码不能为空")),r):(u(t("邮箱格式不正确")),r):(u(t("邮箱不能为空")),r)},C=async()=>{var r,j,w;try{if(!k())return;const{identifier:m}=await U.getId(),{code:I,data:e,msg:A}=await F.loginApi({...a,driver_id:m});if(console.dir(e),I!==200)return N.dialog.alert(A);const n=(r=e==null?void 0:e.user_info)==null?void 0:r.user_id;console.log("user_id",n);const _=await i.findOneById(i.tables.users,"user_id",n);if(_)await i.update(i.tables.users,"user_id",n,{..._,user_info:e==null?void 0:e.user_info});else{const P=await H(n,a.email,!0);await i.add(i.tables.users,{...P,keyPair:null,user_info:e==null?void 0:e.user_info})}d(O,(j=e==null?void 0:e.user_info)==null?void 0:j.user_id),d(D,(w=e==null?void 0:e.user_info)==null?void 0:w.email),d(R,e==null?void 0:e.token),location.reload()}catch(m){console.error("登录失败",m),N.dialog.alert(t("登录失败,请稍后重试"))}finally{h(!1)}};return o.useEffect(()=>{l&&c({email:l.email,password:l.password})},[l]),s.jsxs(T,{loginScreen:!0,noToolbar:!0,children:[s.jsx(b,{className:"fixed top-0 left-0",children:s.jsx($,{className:"text-2xl text-primary",onClick:()=>S.back()})}),s.jsxs(b,{className:"px-2",children:[s.jsx(z,{children:t("登录")}),s.jsxs(L,{form:!0,children:[s.jsx(y,{label:t("邮箱"),type:"text",placeholder:t("请输入邮箱"),className:"el-input",outline:!0,value:a.email,onInput:r=>{c({...a,email:r.target.value}),u("")},floatingLabel:!0,errorMessage:f,errorMessageForce:!!f,children:s.jsx(K,{slot:"media",className:v("w-5 h-5 text-icon-60",E.ios&&"mt-1")})}),s.jsx(y,{label:t("密码"),type:"password",placeholder:t("请输入密码"),value:a.password,onInput:r=>{c({...a,password:r.target.value}),p("")},outline:!0,floatingLabel:!0,errorMessage:x,errorMessageForce:!!x,children:s.jsx(G,{slot:"media",className:v("w-5 h-5 text-icon-60",E.ios&&"mt-1")})}),s.jsx("p",{className:"mx-[18px] mt-[6px] flex justify-end",children:s.jsx(q,{href:"#",className:"text-sm text-blue-500",children:"验证码登录"})})]}),s.jsx(L,{inset:!0,children:s.jsx(B,{onClick:C,large:!0,className:"mx-[16px] mb-5",fill:!0,round:!0,text:t("登录"),children:g&&s.jsx(M,{size:"18",color:"white"})})})]})]})};export{Z as default};

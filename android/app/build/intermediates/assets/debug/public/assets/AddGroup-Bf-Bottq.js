import{r as m,Q as C,j as a,P as w,N as I,$ as t,o as G,b as A,L as h,l as p,ae as E,af as L,ad as x,f as l,ag as b,q as f}from"./index-CyFq9ppu.js";import{C as g,a as u}from"./card-ktBApQtx.js";const P=({f7route:i,f7router:j})=>{var y;const c=m.useMemo(()=>{var e;return(e=i==null?void 0:i.query)==null?void 0:e.id},[(y=i==null?void 0:i.query)==null?void 0:y.id]),[r,d]=m.useState({name:"",avatar:"https://cdn.framework7.io/placeholder/nature-1000x600-3.jpg",type:0,max_members_limit:500,member:[]});C(async()=>{try{const{code:e,data:s,msg:o}=await x.groupInfoApi({group_id:c});if(e!==200){l.dialog.alert(t(o||"获取群信息失败"));return}d(b(s,["name","avatar","type","max_members_limit","member"]))}catch(e){l.dialog.alert(t((e==null?void 0:e.message)||"获取群信息失败"))}finally{l.dialog.close()}},()=>{},[]);const[n,_]=m.useState([]),v=async()=>{try{l.dialog.preloader("创建中...");const{code:e,data:s,msg:o}=await x.createGroupApi(r);if(e!==200){l.dialog.alert(o,t("新建群聊失败"));return}const k={dialog_id:s==null?void 0:s.dialog_id,group_id:s==null?void 0:s.id,dialog_type:s==null?void 0:s.type,dialog_name:s==null?void 0:s.name,dialog_avatar:s==null?void 0:s.avatar,dialog_unread_count:0,last_message:{msg_type:0,content:"",sender_id:"",send_time:0,msg_id:0},dialog_create_at:Date.now(),top_at:0};await f.add(f.tables.dialogs,k),j.back()}catch(e){l.dialog.alert(t((e==null?void 0:e.message)||"群聊创建失败"))}finally{l.dialog.close()}},N=async()=>{try{l.dialog.preloader("修改中...");const{code:e,msg:s}=await x.groupUpdateApi({...b(r,["name","avatar","type"]),group_id:parseInt(c)});if(e!==200){l.dialog.alert(t(s||"编辑群聊失败"));return}e===200&&j.back()}catch(e){l.dialog.alert(t((e==null?void 0:e.message)||"编辑群聊失败"))}finally{l.dialog.close()}};return m.useEffect(()=>{if(!n.length)return;const e=n.map(s=>s.user_id);d({...r,member:e})},[n]),a.jsxs(w,{noToolbar:!0,className:"bg-bgTertiary relative",children:[a.jsx(I,{backLink:!0,title:t(c?"修改群聊信息":"新建群聊"),className:"bg-bgPrimary hidden-navbar-bg",children:a.jsx(G,{children:a.jsx(A,{large:!0,disabled:!r.name,onClick:c?N:v,children:t("完成")})})}),a.jsx(g,{className:"coss_card_title pt-6",children:a.jsxs(u,{className:"flex justify-center flex-col items-center",children:[a.jsx("img",{className:"w-20 h-20 rounded-full mb-5",src:r.avatar}),a.jsx("input",{className:"text-center bg-transparent",placeholder:t("请输入群名称"),name:"name",value:r.name,onChange:e=>d({...r,name:e.target.value})})]})}),a.jsx(g,{title:t("群类型"),className:"coss_card_title",children:a.jsx(u,{children:a.jsxs(h,{strongIos:!0,dividersIos:!0,children:[a.jsx(p,{radio:!0,radioIcon:"end",defaultChecked:r.type==1,name:"type",value:"1",onChange:e=>d({...r,type:Number(e.target.value)}),children:a.jsx("span",{slot:"title",className:"text-base",children:t("公开")})}),a.jsx(p,{radio:!0,radioIcon:"end",defaultChecked:r.type==0,name:"type",value:"0",onChange:e=>d({...r,type:Number(e.target.value)}),children:a.jsx("span",{slot:"title",className:"text-base",children:t("私有")})})]})})}),!c&&a.jsx(g,{title:t("群成员"),className:"coss_card_title",children:a.jsx(u,{padding:!1,children:a.jsx(h,{children:a.jsx(p,{link:!0,popupOpen:".contact-popup",children:t("从好友列表选取")})})})}),a.jsx(g,{title:n.length&&t("已选择"),className:"coss_card_title",children:a.jsx(u,{padding:!1,children:a.jsx(h,{children:n.map((e,s)=>a.jsxs(p,{link:!0,noChevron:!0,title:e==null?void 0:e.nickname,children:[a.jsx("img",{slot:"media",src:e==null?void 0:e.avatar,alt:"",className:"w-12 h-12 rounded-full object-cover"}),a.jsx(E,{slot:"after",onClick:()=>_(n.filter(o=>o!==e))})]},s))})})}),a.jsx(L,{completed:_,defaults:n})]})};export{P as default};

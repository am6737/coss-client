import{E as Q,F as W,m as Z,G as I,r as z,H as ee,M as d,j as s,P as se,N as ae,$ as i,p as te,b as $,I as M,L as R,o as m,J as x,K as j,U as ce,O as F,V as _,w as l,X as O,Y as P}from"./index-D6xPw8DV.js";import{L as K}from"./list-button-BQBTr0QW.js";import{T as f}from"./toggle-DrqY1mOa.js";const T=[{label:i("10秒"),value:10},{label:i("1分钟"),value:60},{label:i("10分钟"),value:600}],le=({f7route:u,f7router:g})=>{var E,w,Y,B;const n=u.params.user_id,U=u.query.from_page==="message",y=Number(u.query.dialog_id)??0;Q();const D=W(),p=Z(),k=I(),[e,v]=z.useState(),{watchAsyncFn:N}=ee(),G=async()=>{var a;try{const t=(a=p.cacheContacts)==null?void 0:a.find(c=>(c==null?void 0:c.user_id)===n);v(t),ce.getUserInfoApi({user_id:n}).then(({code:c,data:r})=>{if(c!==200)return;const o={...t,...r};v(o),h({},o)})}catch(t){console.error("onPageBeforeIn",t)}},h=(a={},t={})=>{var o;const c={...e,preferences:{...e==null?void 0:e.preferences,...a},...t};v(c);const r=(o=p.cacheContacts)==null?void 0:o.map(b=>(b==null?void 0:b.user_id)===n?c:b);p.updateCacheContactsObj(r)},q=async()=>{F("是否确认删除好友","删除好友",async()=>{N(async()=>{var a;try{const{code:t}=await _.deleteFriendApi(n);if(t!==200){l("删除好友失败");return}const c=(a=p.cacheContacts)==null?void 0:a.filter(r=>(r==null?void 0:r.user_id)!==n);p.updateCacheContactsObj(c),O(),P()}catch{l("删除好友失败")}finally{g.back()}},"删除中...")})},H=async()=>{F("是否确认删除所有聊天记录","删除聊天记录",async()=>{N(async()=>{try{await k.deleteAllMessage(y),l("删除聊天记录成功")}catch{l("删除聊天记录失败")}},"删除中...")})},S=async a=>{var r;let t;a?t=d.YES:(t=((r=e==null?void 0:e.preferences)==null?void 0:r.open_burn_after_reading)===d.YES?d.NO:d.YES,a=10);const c=t===d.YES?i("阅后即焚失败"):i("取消阅后即焚失败");h({open_burn_after_reading_time_out:a,open_burn_after_reading:t});try{const{code:o}=await _.setBurnApi({action:t,user_id:n,timeout:a??10});if(o!==200){l(c);return}}catch{l("设置阅后即焚失败")}},J=async()=>{var c;const a=((c=e==null?void 0:e.preferences)==null?void 0:c.silent_notification)===x.YES?x.NO:x.YES,t=a===x.YES?i("消息免打扰失败"):i("取消消息免打扰失败");h({silent_notification:a});try{const{code:r}=await _.setSilenceApi({is_silent:a,user_id:n});if(r!==200){l(t);return}}catch{l("设置消息免打扰失败")}},V=async()=>{const a=(e==null?void 0:e.relation_status)===j.BLACK,t=a?i("移除黑名单失败"):i("添加黑名单失败");h({},{relation_status:a?j.YES:j.BLACK});try{const c={user_id:n},{code:r}=a?await _.deleteBlackListApi(c):await _.addBlackListApi(c);if(r!==200)return l(t);O(),P()}catch{l(t)}},X=async a=>{S(T[a].value)},C=z.useMemo(()=>{var a;return((a=e==null?void 0:e.preferences)==null?void 0:a.open_burn_after_reading)===d.YES},[(E=e==null?void 0:e.preferences)==null?void 0:E.open_burn_after_reading]),L=async(a=!1)=>{var t;await k.init({dialogId:y??0,receiverId:n??0,isGroup:!1,receiverInfo:{dialog_id:e==null?void 0:e.dialog_id,dialog_avatar:e==null?void 0:e.avatar,dialog_name:((t=e==null?void 0:e.preferences)==null?void 0:t.remark)??(e==null?void 0:e.nickname)},isLabel:a}),g==null||g.navigate(`/message/${n}/${y}/?is_group=false&dialog_name=${e.nickname}`)},A=async(a=!1)=>{D.createRoom({recipient:n,isGroup:!1,video:a})};return s.jsxs(se,{className:"profile-page",noToolbar:!0,onPageBeforeIn:G,children:[s.jsx(ae,{title:i("用户信息"),backLink:!0,className:"hidden-navbar-bg"}),s.jsxs("div",{className:"mb-3 p-4 flex flex-col justify-center items-center",children:[s.jsx(te,{size:70,src:e==null?void 0:e.avatar}),s.jsxs("div",{className:"mb-2 flex flex-col items-center",children:[s.jsx("span",{className:"",children:`@${(e==null?void 0:e.nickname)||""}`}),s.jsx("span",{className:"",children:`${(e==null?void 0:e.email)||""}`})]}),s.jsxs("div",{className:"flex my-4 justify-evenly w-full",children:[!U&&s.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",children:[s.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:s.jsx($,{iconF7:"chat_bubble_fill",iconSize:22,onClick:async()=>L()})}),s.jsx("span",{className:"text-xs",children:"消息"})]}),s.jsxs("div",{className:"size-10 flex flex-col justify-center items-center",onClick:()=>A(),children:[s.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:s.jsx(M,{f7:"phone_fill",size:22})}),s.jsx("span",{className:"text-xs",children:"语音"})]}),s.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",onClick:()=>A(!0),children:[s.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:s.jsx(M,{f7:"videocam_fill",size:22})}),s.jsx("span",{className:"text-xs",children:"视频"})]}),s.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",onClick:()=>{},children:[s.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:s.jsx($,{iconF7:"tag_fill",iconSize:22,onClick:async()=>L(!0)})}),s.jsx("span",{className:"text-xs",children:"标注"})]})]})]}),s.jsxs(R,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:[s.jsx(m,{link:`/user_remark/?remark=${(w=e==null?void 0:e.preferences)==null?void 0:w.remark}&user_id=${e==null?void 0:e.user_id}`,title:i("备注"),after:(Y=e==null?void 0:e.preferences)==null?void 0:Y.remark}),s.jsx(m,{title:i("阅后即焚"),children:s.jsx(f,{slot:"after",checked:C,onChange:()=>S()})}),C&&s.jsx("li",{children:s.jsx("ul",{children:T.map((a,t)=>{var c;return s.jsx(m,{title:a.label,children:s.jsx(f,{slot:"after",onChange:()=>X(t),checked:a.value===(((c=e==null?void 0:e.preferences)==null?void 0:c.open_burn_after_reading_time_out)??10)})},t)})})}),s.jsx(m,{title:i("消息免打扰"),children:s.jsx(f,{slot:"after",checked:((B=e==null?void 0:e.preferences)==null?void 0:B.silent_notification)===x.YES,onChange:J})}),s.jsx(m,{title:i("添加到黑名单"),children:s.jsx(f,{slot:"after",checked:(e==null?void 0:e.relation_status)===j.BLACK,onChange:V})})]}),s.jsxs(R,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:[s.jsx(K,{color:"red",onClick:H,children:i("清除聊天记录")}),s.jsx(K,{color:"red",title:i("删除好友"),onClick:q})]})]})};export{le as default};
//# sourceMappingURL=Profile-CBROBEFF.js.map

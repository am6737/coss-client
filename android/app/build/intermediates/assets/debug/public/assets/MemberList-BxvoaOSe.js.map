{"version":3,"file":"MemberList-BxvoaOSe.js","sources":["../../src/pages/GroupInfo/MemberList.tsx"],"sourcesContent":["import { MemberListType, USER_ID } from '@/shared'\nimport { getCookie } from '@/utils/cookie'\nimport { Link, List, ListItem, NavRight, Navbar, Page, Searchbar, Subnavbar, f7 } from 'framework7-react'\nimport { useEffect, useMemo, useState } from 'react'\nimport GroupService from '@/api/group'\nimport RelationService from '@/api/relation'\nimport './MemberList.scss'\n\ninterface MemberListProps {\n\tgroup_id: string\n\tlist_type: MemberListType | string\n}\n\nconst MemberList: React.FC<MemberListProps & RouterProps> = (props) => {\n\tconsole.log(props)\n\n\tconst PageType = props.list_type\n\n\t// 标题\n\tconst getTitle = () => {\n\t\treturn {\n\t\t\tshow: '成员列表',\n\t\t\tplus: '选择联系人',\n\t\t\tminus: '聊天成员'\n\t\t}[PageType]\n\t}\n\n\tconst user_id = getCookie(USER_ID) || ''\n\tconst [identity, setIdentity] = useState(null)\n\n\t// 成员列表\n\tconst [members, setMembers] = useState([])\n\t// 获取成员列表\n\tconst loadMembers = async () => {\n\t\tconst { code, data } = await GroupService.groupMemberApi({ group_id: props.group_id })\n\t\tif (code === 200) {\n\t\t\tconst identity = data?.find((i: any) => i.user_id === user_id).identity\n\t\t\tidentity && setIdentity(identity)\n\t\t\tsetMembers(data)\n\t\t}\n\t}\n\n\t// 好友列表\n\tconst [friends, setFriends] = useState<any[]>([])\n\t// 获取好友列表\n\tconst loadFriends = async () => {\n\t\tconst { code, data: groups } = await RelationService.getFriendListApi()\n\t\tif (code === 200) {\n\t\t\tconst groupMember = []\n\t\t\tfor (const group in groups) {\n\t\t\t\tif (Object.hasOwnProperty.call(groups, group)) {\n\t\t\t\t\tconst groupItem = groups[group] || []\n\t\t\t\t\tfor (const friend of groupItem) {\n\t\t\t\t\t\tgroupMember.push({\n\t\t\t\t\t\t\t...friend,\n\t\t\t\t\t\t\tgroup\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tsetFriends(groupMember)\n\t\t}\n\t}\n\t// 排除好友\n\tconst excludeFriends = useMemo(() => {\n\t\treturn friends.filter((friend) => !members?.find((member: any) => member.user_id === friend.user_id))\n\t}, [friends, members])\n\t// 排除成员\n\tconst excludeMembers = useMemo(() => {\n\t\t// 排除群主、自己以及身份大于自己的成员\n\t\t// 0: 成员 1: 管理 2: 群主\n\t\treturn members.filter(\n\t\t\t(member: any) => member.identity !== 2 && member.user_id !== user_id && member.identity < identity!\n\t\t)\n\t}, [members])\n\n\tconst loadList = async () => {\n\t\tf7.dialog.preloader('加载中...')\n\t\tawait loadMembers()\n\t\tawait loadFriends()\n\t\tf7.dialog.close()\n\t}\n\n\tuseEffect(() => {\n\t\tloadList()\n\t}, [])\n\n\t// 当前选中的人员ID\n\tconst [selected, setSelected] = useState<any[]>([])\n\tconst onMemberChange = (e: any, id: any) => {\n\t\tif (e.target.checked) {\n\t\t\tselected.indexOf(id) === -1 && setSelected([...selected, id])\n\t\t} else {\n\t\t\tsetSelected(selected.filter((item) => item !== id))\n\t\t}\n\t}\n\n\t// 邀请\n\tconst inviteMembers = async () => {\n\t\ttry {\n\t\t\tf7.dialog.preloader('请稍候...')\n\t\t\tconst { code, msg } = await GroupService.groupInviteApi({\n\t\t\t\tgroup_id: parseInt(props.group_id),\n\t\t\t\tmember: selected\n\t\t\t})\n\t\t\tcode === 200 && props.f7router.back()\n\t\t\tcode !== 200 && f7.dialog.alert(msg)\n\t\t} catch (e: any) {\n\t\t\tf7.dialog.alert(e.message)\n\t\t} finally {\n\t\t\tf7.dialog.close()\n\t\t}\n\t}\n\t// 删除\n\tconst removeMembers = async () => {\n\t\tf7.dialog.confirm('移除成员', '确定移除吗？', async () => {\n\t\t\ttry {\n\t\t\t\tf7.dialog.preloader('请稍候...')\n\t\t\t\tconst { code, msg } = await GroupService.groupRemoveApi({\n\t\t\t\t\tgroup_id: parseInt(props.group_id),\n\t\t\t\t\tmember: selected\n\t\t\t\t})\n\t\t\t\tcode === 200 && props.f7router.back()\n\t\t\t\tcode !== 200 && f7.dialog.alert(msg)\n\t\t\t} catch (e: any) {\n\t\t\t\tf7.dialog.alert(e.message)\n\t\t\t} finally {\n\t\t\t\tf7.dialog.close()\n\t\t\t}\n\t\t})\n\t}\n\n\treturn (\n\t\t<Page noToolbar>\n\t\t\t<Navbar\n\t\t\t\ttitle={PageType === MemberListType.MEMBERSHOW ? getTitle() : ''}\n\t\t\t\tbackLink\n\t\t\t\tclassName=\"hidden-navbar-bg\"\n\t\t\t>\n\t\t\t\t{/* <NavTitle>\n\t\t\t\t\t<div className={PageType === MemberListType.MEMBERSHOW && 'mr-14'}>{getTitle()}</div>\n\t\t\t\t</NavTitle> */}\n\t\t\t\t<NavRight>\n\t\t\t\t\t{PageType === MemberListType.NOTMEMBER && <Link onClick={inviteMembers}>邀请</Link>}\n\t\t\t\t\t{PageType === MemberListType.MEMBER && (\n\t\t\t\t\t\t<Link color=\"red\" onClick={removeMembers}>\n\t\t\t\t\t\t\t删除\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t)}\n\t\t\t\t</NavRight>\n\t\t\t\t<Subnavbar>\n\t\t\t\t\t<Searchbar searchContainer=\".contacts-list\" disableButton={false} />\n\t\t\t\t</Subnavbar>\n\t\t\t</Navbar>\n\t\t\t{PageType === MemberListType.NOTMEMBER && (\n\t\t\t\t<List contactsList noChevron dividers className=\"member-list\">\n\t\t\t\t\t{excludeFriends.map((member, index) => (\n\t\t\t\t\t\t<ListItem\n\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\tcheckbox\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\tcheckboxIcon=\"end\"\n\t\t\t\t\t\t\tmedia={member.avatar}\n\t\t\t\t\t\t\ttitle={member.nickname}\n\t\t\t\t\t\t\tsubtitle={member.email}\n\t\t\t\t\t\t\tonChange={(e) => onMemberChange(e, member.user_id)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</List>\n\t\t\t)}\n\t\t\t{PageType === MemberListType.MEMBER && (\n\t\t\t\t<List contactsList noChevron dividers className=\"member-list\">\n\t\t\t\t\t{excludeMembers.map((member: any, index) => (\n\t\t\t\t\t\t<ListItem\n\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\tcheckbox\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\tcheckboxIcon=\"end\"\n\t\t\t\t\t\t\tmedia={member.avatar}\n\t\t\t\t\t\t\ttitle={member.nickname}\n\t\t\t\t\t\t\tsubtitle={member.email}\n\t\t\t\t\t\t\tonChange={(e) => onMemberChange(e, member.user_id)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</List>\n\t\t\t)}\n\t\t\t{PageType === MemberListType.MEMBERSHOW && (\n\t\t\t\t<List contactsList noChevron dividers className=\"member-list\">\n\t\t\t\t\t{members.map((member: any, index) => (\n\t\t\t\t\t\t<ListItem key={index} media={member.avatar} title={member.nickname} footer={member.email}>\n\t\t\t\t\t\t\t<div slot=\"after\" className=\"text-sm\">\n\t\t\t\t\t\t\t\t{member.identity === 2 && <span>群主</span>}\n\t\t\t\t\t\t\t\t{member.identity === 1 && <span>管理员</span>}\n\t\t\t\t\t\t\t\t{member.identity === 0 && <span>成员</span>}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</ListItem>\n\t\t\t\t\t))}\n\t\t\t\t</List>\n\t\t\t)}\n\t\t</Page>\n\t)\n}\n\nexport default MemberList\n"],"names":["MemberList","props","PageType","getTitle","user_id","getCookie","USER_ID","identity","setIdentity","useState","members","setMembers","loadMembers","code","data","GroupService","i","friends","setFriends","loadFriends","groups","RelationService","groupMember","group","groupItem","friend","excludeFriends","useMemo","member","excludeMembers","loadList","f7","useEffect","selected","setSelected","onMemberChange","id","item","inviteMembers","msg","removeMembers","jsxs","Page","Navbar","MemberListType","NavRight","jsx","Link","Subnavbar","Searchbar","List","index","ListItem","e"],"mappings":"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"}
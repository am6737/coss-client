import{r as k,v as q,w as T,x as D,j as a,P as K,N as O,$ as s,a as p,L as S,l as h,M as d,y as g,z as u,q as c,U as G,E as H,F as J,G as Q,f as i,H as m}from"./index-CyFq9ppu.js";import{L as v}from"./list-button-DmtekqvR.js";import{T as _}from"./toggle-aaGGTprW.js";const Z=({f7route:x,f7router:j})=>{var N,w;const r=x.params.user_id,C=x.query.from_page==="message",E=Number(x.query.dialog_id)??0,L=k.useRef({el:null}),[e,y]=k.useState({}),{updateContacts:A}=q(),{clearMessages:z}=T(),B=async()=>{await f(!0)},f=async(l=!0)=>{const t=await c.findOneById(c.tables.friends,"user_id",r);if(y(t),t&&!l)return;const{data:o}=await G.getUserInfoApi({user_id:r}),n={...t,...o};H(t,n)||(y(n),t?await c.update(c.tables.friends,"user_id",r,n):await c.add(c.tables.friends,{...n,dialog_id:E,group:"#"}))},{call:Y,updateEnablesVideo:F}=D(),b=async l=>{try{await J(),l&&await Q(),i.dialog.preloader(s("呼叫中...")),F(l),await Y({userInfo:e}),i.dialog.close(),j.navigate("/call/")}catch(t){if(console.log(t==null?void 0:t.code,(t==null?void 0:t.code)===8),console.dir(t),(t==null?void 0:t.code)===8){i.dialog.alert(s("当前媒体设备不可用，无法接听来电"));return}i.dialog.alert(s((t==null?void 0:t.message)||"呼叫失败..."))}finally{i.dialog.close()}},R=async()=>{i.dialog.confirm(s("是否确认删除好友?"),s("删除好友"),async()=>{try{i.dialog.preloader(s("删除中..."));const{code:l}=await m.deleteFriendApi(r);if(l!==200){i.dialog.alert(s("删除好友失败"));return}A(!0),await c.delete(c.tables.friends,"user_id",r)}catch(l){return console.log("删除好友失败",l),i.dialog.alert(s("删除好友失败"))}finally{i.dialog.close(),j.back()}})},U=async()=>{i.dialog.confirm(s("是否确认删除所有聊天记录?"),s("删除聊天记录"),async()=>{try{i.dialog.preloader(s("删除中...")),await c.delete(c.tables.messages,"dialog_id",e.dialog_id),await z(),i.dialog.alert(s("删除聊天记录成功"))}catch{return i.dialog.alert(s("删除聊天记录失败"))}finally{i.dialog.close()}})},$=async()=>{var o;const l=((o=e==null?void 0:e.preferences)==null?void 0:o.open_burn_after_reading)===d.YES?d.NO:d.YES,t=l===d.YES?s("阅后即焚失败"):s("取消阅后即焚失败");try{i.dialog.preloader(s("设置中..."));const{code:n}=await m.setBurnApi({action:l,user_id:r});if(n!==200){i.dialog.alert(t);return}await c.update(c.tables.friends,"user_id",r,{preferences:{...e==null?void 0:e.preferences,open_burn_after_reading:l}}),await f(!1)}catch{return i.dialog.alert(t)}finally{i.dialog.close()}},M=async()=>{var o;const l=((o=e==null?void 0:e.preferences)==null?void 0:o.silent_notification)===g.YES?g.NO:g.YES,t=l===g.YES?s("消息免打扰失败"):s("取消消息免打扰失败");try{i.dialog.preloader(s("消息免打扰中..."));const{code:n}=await m.setSilenceApi({is_silent:l,user_id:r});if(n!==200){i.dialog.alert(t);return}await c.update(c.tables.friends,"user_id",r,{preferences:{...e==null?void 0:e.preferences,silent_notification:l}}),await f(!1)}catch{return i.dialog.alert(t)}finally{i.dialog.close()}},P=async()=>{console.log("userInfo",e);const l=(e==null?void 0:e.relation_status)===u.BLACK,t=l?s("移除黑名单失败"):s("添加黑名单失败");try{i.dialog.preloader(l?s("移除黑名单中..."):s("加入黑名单中..."));const o={user_id:r},{code:n}=l?await m.deleteBlackListApi(o):await m.addBlackListApi(o);if(n!==200){i.dialog.alert(t);return}await c.update(c.tables.friends,"user_id",r,{relation_status:l?u.YES:u.BLACK}),await f(!1)}catch{return i.dialog.alert(t)}finally{i.dialog.close()}};return a.jsxs(K,{ref:L,className:"profile-page bg-bgTertiary",noToolbar:!0,onPageInit:B,children:[a.jsx(O,{title:s("用户信息"),backLink:!0,className:"bg-bgPrimary hidden-navbar-bg"}),a.jsxs("div",{className:"mb-3 p-4 bg-white flex flex-col justify-center items-center",children:[a.jsx("img",{className:"mb-2 size-20 rounded-full bg-black bg-opacity-10",src:e==null?void 0:e.avatar,alt:""}),a.jsxs("div",{className:"mb-2 flex flex-col items-center",children:[a.jsx("span",{className:"",children:`@${(e==null?void 0:e.nickname)||""}`}),a.jsx("span",{className:"",children:`${(e==null?void 0:e.email)||""}`})]}),a.jsxs("div",{className:"flex my-4 justify-evenly w-full",children:[!C&&a.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",children:[a.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:a.jsx(p,{iconF7:"chat_bubble_fill",iconSize:22,href:`/message/${r}/${e==null?void 0:e.dialog_id}/?is_group=false&dialog_name=${e==null?void 0:e.nickname}`})}),a.jsx("span",{className:"text-xs",children:"消息"})]}),a.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",onClick:()=>b(!0),children:[a.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:a.jsx(p,{iconF7:"videocam_fill",iconSize:22,onClick:()=>b(!0)})}),a.jsx("span",{className:"text-xs",children:"视频"})]}),a.jsxs("div",{className:"size-10 flex flex-col justify-center items-center",onClick:()=>b(!1),children:[a.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:a.jsx(p,{iconF7:"phone_fill",iconSize:22})}),a.jsx("span",{className:"text-xs",children:"语音"})]}),a.jsxs("div",{className:"size-10  flex flex-col justify-center items-center",onClick:()=>{},children:[a.jsx("div",{className:"mb-2 p-2 rounded-full bg-black bg-opacity-10",children:a.jsx(p,{iconF7:"tag_fill",iconSize:22})}),a.jsx("span",{className:"text-xs",children:"标注"})]})]})]}),a.jsxs(S,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:[a.jsx(h,{title:s("阅后即焚"),children:a.jsx(_,{slot:"after",checked:((N=e==null?void 0:e.preferences)==null?void 0:N.open_burn_after_reading)===d.YES,onChange:$})}),a.jsx(h,{title:s("消息免打扰"),children:a.jsx(_,{slot:"after",checked:((w=e==null?void 0:e.preferences)==null?void 0:w.silent_notification)===g.YES,onChange:M})}),a.jsx(h,{title:s("添加到黑名单"),children:a.jsx(_,{slot:"after",checked:(e==null?void 0:e.relation_status)===u.BLACK,onChange:P})})]}),a.jsxs(S,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:[a.jsx(v,{color:"red",onClick:U,children:s("清除聊天记录")}),a.jsx(v,{color:"red",title:s("删除好友"),onClick:R})]})]})};export{Z as default};

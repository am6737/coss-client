{"version":3,"file":"GroupInfo-4hhFRQYo.js","sources":["../../src/pages/GroupInfo/GroupInfo.tsx"],"sourcesContent":["import { $t, MemberListType, USER_ID } from '@/shared'\nimport { Icon, List, ListItem, Navbar, Page, Toggle, f7 } from 'framework7-react'\nimport { useEffect, useState } from 'react'\nimport GroupService from '@/api/group'\nimport { getCookie } from '@/utils/cookie'\nimport Avatar from '@/components/Avatar/Avatar.tsx'\n\nconst user_id = getCookie(USER_ID) || ''\n\ninterface GroupInfoProps {\n\tgroup_id: string\n}\n\nconst GroupInfo: React.FC<GroupInfoProps & RouterProps> = (props) => {\n\tconst { f7router, group_id: GroupId } = props\n\t// 聊天类型：group | friend\n\n\t// const { user } = useUserStore()\n\tconst [identity, setIdentity] = useState(null)\n\n\t// 消息免打扰\n\tconst [silence, setSilence] = useState(false)\n\n\t// 群聊信息\n\tconst [groupInfo, setGroupInfo] = useState<any>()\n\n\tuseEffect(() => {\n\t\t;(async () => {\n\t\t\t// 获取群聊信息\n\t\t\tconst { code, data } = await GroupService.groupInfoApi({ group_id: GroupId })\n\t\t\tif (code !== 200) return\n\t\t\tcode === 200 && setGroupInfo(data)\n\t\t\tconst isSilence = data?.preferences?.silent_notification\n\t\t\tsetSilence(isSilence === 1)\n\t\t})()\n\t}, [])\n\n\t// 群成员\n\tconst [members, setMembers] = useState([])\n\tuseEffect(() => {\n\t\t;(async () => {\n\t\t\t// 获取成员信息\n\t\t\tconst { code, data } = await GroupService.groupMemberApi({ group_id: GroupId })\n\t\t\tif (code !== 200) return\n\t\t\tconst identity = data?.find((i: any) => i.user_id === user_id).identity\n\t\t\tidentity && setIdentity(identity)\n\t\t\tsetMembers(data)\n\t\t})()\n\t}, [])\n\n\t// 退出群聊\n\tconst quitGroup = async () => {\n\t\tf7.dialog.confirm('退出群聊', '确定要退出群聊吗？', async () => {\n\t\t\ttry {\n\t\t\t\tf7.dialog.preloader('正在退出...')\n\t\t\t\tconst { code, msg } = await GroupService.groupQuitApi({ group_id: Number(GroupId) })\n\t\t\t\tcode === 200 && f7router.back()\n\t\t\t\tcode !== 200 && f7.dialog.alert(msg)\n\t\t\t} catch (error: any) {\n\t\t\t\tf7.dialog.alert(error.message, '退出失败...')\n\t\t\t} finally {\n\t\t\t\tf7.dialog.close()\n\t\t\t}\n\t\t})\n\t}\n\n\t// 解散群聊\n\tconst dissolveGroup = async () => {\n\t\tf7.dialog.confirm('解散群聊', '确定要解散群聊吗？', async () => {\n\t\t\ttry {\n\t\t\t\tf7.dialog.preloader('正在解散...')\n\t\t\t\tconst { code, msg } = await GroupService.groupDissolve({ group_id: Number(GroupId) })\n\t\t\t\tcode === 200 && f7router.back()\n\t\t\t\tcode !== 200 && f7.dialog.alert(msg)\n\t\t\t} catch (error: any) {\n\t\t\t\tf7.dialog.alert(error.message, '解散失败...')\n\t\t\t} finally {\n\t\t\t\tf7.dialog.close()\n\t\t\t}\n\t\t})\n\t}\n\n\tconst onChangeChecked = async () => {\n\t\tconst isSilence = !silence\n\t\tsetSilence(isSilence)\n\t\ttry {\n\t\t\tconst { code } = await GroupService.setGroupSilenceApi({\n\t\t\t\tgroup_id: Number(GroupId),\n\t\t\t\tis_silent: isSilence ? 1 : 0\n\t\t\t})\n\t\t\tif (code !== 200) return\n\t\t} catch (error: any) {\n\t\t\tf7.dialog.alert(error.message, '设置失败')\n\t\t\t// setSilence(!isSilence)\n\t\t}\n\t}\n\n\t//! 解决傻逼底部导航栏莫名其妙的显示问题\n\tconst handlerToolbar = (show: boolean = false) => {\n\t\tconst framework7Root = document.getElementById('framework7-root')\n\t\tif (framework7Root) {\n\t\t\tshow ? framework7Root.classList.remove('hidden-toolbar') : framework7Root.classList.add('hidden-toolbar')\n\t\t}\n\t}\n\n\treturn (\n\t\t<Page noToolbar onPageBeforeIn={() => handlerToolbar(false)} onPageBeforeOut={() => handlerToolbar(true)}>\n\t\t\t<Navbar title={$t('群聊信息')} backLink className=\"hidden-navbar-bg\" />\n\t\t\t<List className=\"m-0 mb-3 bg-white\" strong dividers outline>\n\t\t\t\t<ListItem noChevron>\n\t\t\t\t\t<div className=\"w-full flex flex-col justify-center items-center\">\n\t\t\t\t\t\t<div className=\"mb-1 w-full grid grid-cols-5 gap-6\">\n\t\t\t\t\t\t\t{members.slice(0, 23).map((item: any) => (\n\t\t\t\t\t\t\t\t<div key={item.user_id} className=\"w-12 h-[144rpx] flex flex-col items-center\">\n\t\t\t\t\t\t\t\t\t<div className=\"min-w-12 min-h-12 overflow-hidden\">\n\t\t\t\t\t\t\t\t\t\t<Avatar size={50} square src={item.avatar} />\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\t\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\t\t\t\t\ttextOverflow: 'ellipsis'\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-12 min-w-12 min-h-6 flex-1 text-sm text-gray-400 max-w-12 overflow-hidden text-ellipsis\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{item.nickname}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"w-12 h-12 flex flex-col justify-center items-center border-dashed border-[1px] border-gray-400 text-gray-500 rounded-lg\"\n\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\tf7router.navigate(`/group_info/${GroupId}/member/${MemberListType.NOTMEMBER}`)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon f7=\"plus\" size={18} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{identity && (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"w-12 h-12 flex flex-col justify-center items-center border-dashed border-[1px] border-gray-400 text-gray-500 rounded-lg\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\tf7router.navigate(`/group_info/${GroupId}/member/${MemberListType.MEMBER}`)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Icon f7=\"minus\" size={18} />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{members.length > 0 && (\n\t\t\t\t\t\t\t<div className=\"mb-1\">\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclassName=\"text-sm text-gray-500\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\tf7router.navigate(`/group_info/${GroupId}/member/${MemberListType.MEMBERSHOW}`)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t查看更多群成员\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</ListItem>\n\t\t\t</List>\n\t\t\t<List className=\"m-0 mb-3 bg-white\" strong dividers outline>\n\t\t\t\t<ListItem title=\"群聊名称\" link={identity === 2 ? `/create_group/?id=${groupInfo?.id}` : ''}>\n\t\t\t\t\t<div slot=\"after\">\n\t\t\t\t\t\t<span>{groupInfo?.name}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</ListItem>\n\t\t\t\t<ListItem link={`/group_notice/${GroupId}/?identity=${identity}`} title=\"群公告\"></ListItem>\n\t\t\t\t<ListItem link={`/group_qrcode/?group_id=${GroupId}`} title=\"群二维码\"></ListItem>\n\t\t\t\t<ListItem\n\t\t\t\t\tlink={`/group_user_display_name/?group_id=${GroupId}&remark=${groupInfo?.preferences.remark}`}\n\t\t\t\t\ttitle=\"我在群组的昵称\"\n\t\t\t\t\tafter={groupInfo?.preferences.remark}\n\t\t\t\t/>\n\t\t\t</List>\n\t\t\t<List className=\"m-0 mb-3 bg-white\" strong dividers outline noChevron>\n\t\t\t\t<ListItem title=\"消息免打扰\">\n\t\t\t\t\t<Toggle slot=\"after\" onChange={onChangeChecked} checked={silence} />\n\t\t\t\t</ListItem>\n\t\t\t</List>\n\t\t\t<List className=\"m-0 mb-3 bg-white\" strong dividers outline>\n\t\t\t\t<ListItem noChevron link>\n\t\t\t\t\t<div\n\t\t\t\t\t\tslot=\"inner\"\n\t\t\t\t\t\tclassName=\"w-full flex justify-center items-center\"\n\t\t\t\t\t\tonClick={identity ? dissolveGroup : quitGroup}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span className=\"text-sm text-red-500\">{identity === 2 ? '解散群聊' : '退出群聊'}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</ListItem>\n\t\t\t</List>\n\t\t</Page>\n\t)\n}\n\nexport default GroupInfo\n"],"names":["user_id","getCookie","USER_ID","GroupInfo","props","f7router","GroupId","identity","setIdentity","useState","silence","setSilence","groupInfo","setGroupInfo","useEffect","code","data","GroupService","isSilence","_a","members","setMembers","i","quitGroup","f7","msg","error","dissolveGroup","onChangeChecked","handlerToolbar","show","framework7Root","jsxs","Page","jsx","Navbar","$t","List","ListItem","item","Avatar","MemberListType","Icon","Toggle"],"mappings":"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"}
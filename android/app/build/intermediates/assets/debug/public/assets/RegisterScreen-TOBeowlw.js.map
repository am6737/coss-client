{"version":3,"file":"RegisterScreen-TOBeowlw.js","sources":["../../src/pages/Auth/RegisterScreen.tsx"],"sourcesContent":["import { Button, List, ListInput, LoginScreenTitle, theme, Preloader, Page, Block, f7 } from 'framework7-react'\nimport { At, ChevronLeft, Lock } from 'framework7-icons/react'\nimport { useState } from 'react'\nimport clsx from 'clsx'\n\nimport { $t } from '@/shared'\nimport type { RegisterData } from '@/types/api/user'\nimport './Auth.scss'\nimport { validEmail, validPassword } from '@/utils/validate'\nimport UserService from '@/api/user'\n// import useCacheStore from '@/stores/cache'\nimport useUserStore from '@/stores/user'\n\nconst RegisterScreen: React.FC<RouterProps> = ({ f7router }) => {\n\tconst [fromData, setFromData] = useState<RegisterData>({\n\t\tnickname: '',\n\t\temail: '',\n\t\tpassword: '',\n\t\tconfirm_password: ''\n\t})\n\n\t// 错误提示\n\tconst [emailError, setEmailError] = useState<string>('')\n\tconst [passwordError, setPasswordError] = useState<string>('')\n\tconst [confirmPasswordError, setConfirmPasswordError] = useState<string>('')\n\n\t// 登录loading\n\tconst [loading, setLoading] = useState<boolean>(false)\n\n\tconst userStore = useUserStore()\n\t// const cacheStore = useCacheStore()\n\n\tconst valid = (): boolean => {\n\t\tlet pass = false\n\t\t// 判断是否正在登录\n\t\tif (loading) return pass\n\n\t\t// 初步校验\n\t\tif (!fromData.email.trim()) {\n\t\t\tsetEmailError($t('邮箱不能为空'))\n\t\t\treturn pass\n\t\t}\n\t\tif (!validEmail(fromData.email.trim())) {\n\t\t\tsetEmailError($t('邮箱格式不正确'))\n\t\t\treturn pass\n\t\t}\n\t\tif (!fromData.password.trim()) {\n\t\t\tsetPasswordError($t('密码不能为空'))\n\t\t\treturn pass\n\t\t}\n\t\tif (!validPassword(fromData.password.trim())) {\n\t\t\tsetPasswordError($t('密码强度不够'))\n\t\t\treturn pass\n\t\t}\n\t\tif (!fromData.confirm_password.trim()) {\n\t\t\tsetConfirmPasswordError($t('确认密码不能为空'))\n\t\t\treturn pass\n\t\t}\n\t\tif (fromData.password.trim() !== fromData.confirm_password.trim()) {\n\t\t\tsetConfirmPasswordError($t('两次密码不一致'))\n\t\t\treturn pass\n\t\t}\n\n\t\tpass = true\n\t\tsetLoading(true)\n\t\treturn pass\n\t}\n\n\tconst submit = async () => {\n\t\ttry {\n\t\t\tif (!valid()) return\n\n\t\t\tconst { code, data, msg } = await UserService.registerApi(fromData)\n\t\t\tif (code !== 200) {\n\t\t\t\tf7.dialog.alert(msg)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tuserStore.update({ userId: data?.user_id })\n\t\t\t// await cretaeIdentity(data.user_id, fromData.email)\n\t\t\tf7router.navigate('/login/', { props: { defaultData: fromData } })\n\t\t} catch {\n\t\t\tf7.dialog.alert($t('注册失败,请稍后重试'))\n\t\t} finally {\n\t\t\tsetLoading(false)\n\t\t}\n\t}\n\n\treturn (\n\t\t<Page loginScreen noToolbar>\n\t\t\t<Block className=\"fixed top-0 left-0\">\n\t\t\t\t<ChevronLeft className=\"text-2xl text-primary\" onClick={() => f7router.back()} />\n\t\t\t</Block>\n\t\t\t<Block className=\"px-2\">\n\t\t\t\t<LoginScreenTitle>{$t('注册')}</LoginScreenTitle>\n\t\t\t\t<List form>\n\t\t\t\t\t<ListInput\n\t\t\t\t\t\tlabel={$t('用户名')}\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tplaceholder={$t('请输入用户名')}\n\t\t\t\t\t\toutline\n\t\t\t\t\t\tvalue={fromData.nickname}\n\t\t\t\t\t\tonInput={(e) => {\n\t\t\t\t\t\t\tsetFromData({ ...fromData, nickname: e.target.value })\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tfloatingLabel\n\t\t\t\t\t\tclassName=\"el-input\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Lock slot=\"media\" className={clsx('w-5 h-5 text-icon-60', theme.ios && 'mt-1')} />\n\t\t\t\t\t</ListInput>\n\t\t\t\t\t<ListInput\n\t\t\t\t\t\tlabel={$t('邮箱')}\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tplaceholder={$t('请输入邮箱')}\n\t\t\t\t\t\tclassName=\"el-input\"\n\t\t\t\t\t\toutline\n\t\t\t\t\t\tvalue={fromData.email}\n\t\t\t\t\t\tonInput={(e) => {\n\t\t\t\t\t\t\tsetFromData({ ...fromData, email: e.target.value })\n\t\t\t\t\t\t\tsetEmailError('')\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tfloatingLabel\n\t\t\t\t\t\terrorMessage={emailError}\n\t\t\t\t\t\terrorMessageForce={!!emailError}\n\t\t\t\t\t>\n\t\t\t\t\t\t<At slot=\"media\" className={clsx('w-5 h-5 text-icon-60', theme.ios && 'mt-1')} />\n\t\t\t\t\t</ListInput>\n\t\t\t\t\t<ListInput\n\t\t\t\t\t\tlabel={$t('密码')}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tplaceholder={$t('请输入密码')}\n\t\t\t\t\t\tclassName=\"el-input\"\n\t\t\t\t\t\toutline\n\t\t\t\t\t\tvalue={fromData.password}\n\t\t\t\t\t\tonInput={(e) => {\n\t\t\t\t\t\t\tsetFromData({ ...fromData, password: e.target.value })\n\t\t\t\t\t\t\tsetPasswordError('')\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tfloatingLabel\n\t\t\t\t\t\terrorMessage={passwordError}\n\t\t\t\t\t\terrorMessageForce={!!passwordError}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Lock slot=\"media\" className={clsx('w-5 h-5 text-icon-60', theme.ios && 'mt-1')} />\n\t\t\t\t\t</ListInput>\n\t\t\t\t\t<ListInput\n\t\t\t\t\t\tlabel={$t('确认密码')}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tplaceholder={$t('请输入确认密码')}\n\t\t\t\t\t\tclassName=\"el-input\"\n\t\t\t\t\t\toutline\n\t\t\t\t\t\tvalue={fromData.confirm_password}\n\t\t\t\t\t\tonInput={(e) => {\n\t\t\t\t\t\t\tsetFromData({ ...fromData, confirm_password: e.target.value })\n\t\t\t\t\t\t\tsetConfirmPasswordError('')\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tfloatingLabel\n\t\t\t\t\t\terrorMessage={confirmPasswordError}\n\t\t\t\t\t\terrorMessageForce={!!confirmPasswordError}\n\t\t\t\t\t>\n\t\t\t\t\t\t<At slot=\"media\" className={clsx('w-5 h-5 text-icon-60', theme.ios && 'mt-1')} />\n\t\t\t\t\t</ListInput>\n\t\t\t\t</List>\n\t\t\t\t<List inset>\n\t\t\t\t\t<Button onClick={submit} large className=\"mx-[16px] mb-5\" fill round text={$t('注册')}>\n\t\t\t\t\t\t{loading && <Preloader size=\"18\" color=\"white\" />}\n\t\t\t\t\t</Button>\n\t\t\t\t</List>\n\t\t\t</Block>\n\t\t</Page>\n\t)\n}\n\nexport default RegisterScreen\n"],"names":["RegisterScreen","f7router","fromData","setFromData","useState","emailError","setEmailError","passwordError","setPasswordError","confirmPasswordError","setConfirmPasswordError","loading","setLoading","userStore","useUserStore","valid","pass","validEmail","validPassword","$t","submit","code","data","msg","UserService","f7","jsxs","Page","jsx","Block","ChevronLeft","LoginScreenTitle","List","ListInput","Lock","clsx","theme","At","Button","Preloader"],"mappings":"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"}
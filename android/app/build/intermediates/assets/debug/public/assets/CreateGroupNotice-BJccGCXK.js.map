{"version":3,"file":"CreateGroupNotice-BJccGCXK.js","sources":["../../src/pages/CreateGroupNotice/CreateGroupNotice.tsx"],"sourcesContent":["import { $t } from '@/shared'\nimport { Button, Card, CardContent, NavRight, Navbar, Page, f7 } from 'framework7-react'\nimport { useMemo, useState } from 'react'\nimport GroupService from '@/api/group'\nimport { useAsyncEffect } from '@reactuses/core'\nimport { mapValues, pick } from 'lodash-es'\n\ninterface Notification {\n\tid?: number\n\tgroup_id: number\n\ttitle: string\n\tcontent: string\n\tcreate_at?: number\n\tupdate_at?: number\n\toperator_info?: {\n\t\tuser_id: string\n\t\tavatar: string\n\t\tname: string\n\t}\n}\n\nconst CreateGroupNotice: React.FC<RouterProps> = ({ f7route, f7router }) => {\n\t// 群ID\n\tconst group_id = useMemo(() => {\n\t\treturn f7route?.params?.group_id\n\t}, [f7route?.params?.group_id])\n\t// 是否管理员\n\tconst is_admin = useMemo(() => {\n\t\tconsole.log(f7route?.query)\n\t\treturn f7route?.query?.admin === 'true'\n\t}, [f7route?.query?.dmin])\n\t// 公告ID\n\tconst id = useMemo(() => {\n\t\treturn f7route?.query?.id\n\t}, [f7route?.query?.id])\n\t// 是否创建模式\n\tconst is_created = useMemo(() => {\n\t\treturn id === undefined\n\t}, [id])\n\n\t// 公告\n\tconst [notification, setNotification] = useState<Notification>({\n\t\tgroup_id: group_id ? parseInt(group_id) : -1,\n\t\ttitle: '',\n\t\tcontent: ''\n\t})\n\t// 公告详情\n\tconst [notificationDetail, setNotificationDetail] = useState<Notification>({\n\t\tgroup_id: group_id ? parseInt(group_id) : -1,\n\t\ttitle: '',\n\t\tcontent: ''\n\t})\n\n\t// 获取公告详情\n\tuseAsyncEffect(\n\t\tasync () => {\n\t\t\tif (is_created) return\n\t\t\tconst { code, data } = await GroupService.getGroupAnnouncementApi({\n\t\t\t\tgroup_id,\n\t\t\t\tid\n\t\t\t})\n\t\t\tif (code === 200) {\n\t\t\t\tsetNotificationDetail(data)\n\t\t\t\tsetNotification(\n\t\t\t\t\tmapValues(notification, (_, key) => {\n\t\t\t\t\t\tconst value = data[key]\n\t\t\t\t\t\tif (['group_id', 'id'].includes(key) && typeof value === 'string') {\n\t\t\t\t\t\t\treturn parseInt(value)\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn value\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t\tawait GroupService.readGroupAnnouncementApi({\n\t\t\t\t\tgroup_id: parseInt(group_id!),\n\t\t\t\t\tid: parseInt(id!)\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t() => {},\n\t\t[is_created, group_id, id]\n\t)\n\n\t// 创建群公告\n\tconst createNotification = async () => {\n\t\ttry {\n\t\t\tf7.dialog.preloader($t('创建中...'))\n\t\t\tconst { code, msg } = await GroupService.createGroupAnnouncementApi(notification)\n\t\t\tif (code !== 200) {\n\t\t\t\tf7.dialog.alert($t(msg))\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (code === 200) {\n\t\t\t\tf7router.back()\n\t\t\t\tsetNotification({ ...notification, title: '', content: '' })\n\t\t\t}\n\t\t} catch (error: any) {\n\t\t\tf7.dialog.alert($t(error?.message || '群公告创建失败...'))\n\t\t} finally {\n\t\t\tf7.dialog.close()\n\t\t}\n\t}\n\n\t// 编辑\n\tconst editNotification = async () => {\n\t\ttry {\n\t\t\tf7.dialog.preloader($t('编辑中...'))\n\t\t\tconst reqData = {\n\t\t\t\t...notificationDetail,\n\t\t\t\t...notification\n\t\t\t}\n\t\t\tpick(reqData, ['group_id', 'id', 'title', 'content'])\n\t\t\tconst { code, msg } = await GroupService.updateGroupAnnouncementApi(reqData)\n\t\t\tif (code !== 200) {\n\t\t\t\tf7.dialog.alert($t(msg))\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (code === 200) {\n\t\t\t\tf7router.back()\n\t\t\t\tsetNotification({ ...notification, title: '', content: '' })\n\t\t\t\tsetNotificationDetail({ ...notificationDetail, title: '', content: '' })\n\t\t\t}\n\t\t} catch (error: any) {\n\t\t\tf7.dialog.alert($t(error?.message || '群公告编辑失败...'))\n\t\t} finally {\n\t\t\tf7.dialog.close()\n\t\t}\n\t}\n\n\treturn (\n\t\t<Page noToolbar className=\"bg-bgTertiary\">\n\t\t\t<Navbar\n\t\t\t\ttitle={is_created ? $t('创建群公告') : $t(is_admin ? '编辑群公告' : '群公告详情')}\n\t\t\t\tbackLink\n\t\t\t\tclassName=\"bg-bgPrimary\"\n\t\t\t>\n\t\t\t\t<NavRight>\n\t\t\t\t\t{is_admin && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tlarge\n\t\t\t\t\t\t\tdisabled={!notification.title || !notification.content}\n\t\t\t\t\t\t\tonClick={is_created ? createNotification : editNotification}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{$t('完成')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</NavRight>\n\t\t\t</Navbar>\n\n\t\t\t<Card className=\"coss_card_title\">\n\t\t\t\t<CardContent className=\"flex justify-center flex-col items-center\">\n\t\t\t\t\t{is_admin ? (\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclassName=\"bg-transparent w-full text-base\"\n\t\t\t\t\t\t\tname=\"title\"\n\t\t\t\t\t\t\tplaceholder={$t('请输入标题')}\n\t\t\t\t\t\t\tvalue={notification?.title}\n\t\t\t\t\t\t\tonChange={(e) => setNotification({ ...notification, title: e.target.value })}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"w-full break-all text-base\">{notification?.title}</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card className=\"coss_card_content\">\n\t\t\t\t<CardContent className=\"flex justify-center flex-col items-center\">\n\t\t\t\t\t{is_admin ? (\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tclassName=\"bg-transparent w-full\"\n\t\t\t\t\t\t\tname=\"content\"\n\t\t\t\t\t\t\tplaceholder={$t('请填写内容')}\n\t\t\t\t\t\t\trows={5}\n\t\t\t\t\t\t\tvalue={notification?.content}\n\t\t\t\t\t\t\tonChange={(e) => setNotification({ ...notification, content: e.target.value })}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"text-gray-600 w-full break-all\">{notification?.content}</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</Page>\n\t)\n}\n\nexport default CreateGroupNotice\n"],"names":["CreateGroupNotice","f7route","f7router","group_id","useMemo","_a","is_admin","_b","id","_c","is_created","notification","setNotification","useState","notificationDetail","setNotificationDetail","useAsyncEffect","code","data","GroupService","mapValues","key","value","createNotification","f7","$t","msg","error","editNotification","reqData","pick","jsxs","Page","jsx","Navbar","NavRight","Button","Card","CardContent"],"mappings":"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"}
import{m as b,G as y,r as p,a0 as C,$ as u,j as t,P as l,N as L,_ as $,S as N,at as w,L as T,o as k,p as E,au as I,av as M}from"./index-D6xPw8DV.js";import{S as P}from"./searchbar-DXQBL9hB.js";const O=({f7router:h})=>{const i=b(),f=y(),[c,j]=p.useState(""),[v,o]=p.useState([]);C(async()=>{const e=[];if(c.trim()===""){o([]);return}await Promise.all(i.cacheDialogs.map(async s=>{const n={...s,msgs:[]},r=await i.get(`${s.dialog_id}`);if(r.length<=0)return;const a=r.filter(m=>m.msg_type===I.TEXT);if(a.length<=0)return;const _=a.filter(m=>x(m.content).indexOf(c)!==-1);(s.dialog_name.indexOf(c)!==-1||_.length>0)&&(n.msgs=_,e.push(n))})),o(e)},()=>{},[c]);const x=p.useCallback(e=>{const s=new DOMParser().parseFromString(e,"text/html"),n=s.querySelectorAll("img");if(n.length){const r=document.createElement("span");r.textContent=u("[图片]");for(let a=0;a<n.length;a++)n[a].replaceWith(r);e=s.body.innerHTML}return e},[]),S=e=>e.msgs.map(s=>{var n,r;return t.jsx(M,{content:(e!=null&&e.group_id&&((n=s==null?void 0:s.sender_info)!=null&&n.name)?((r=s.sender_info)==null?void 0:r.name)+":":"")+x((s==null?void 0:s.content)??""),className:"dialog-read-editor"})});return t.jsxs(l,{className:"group-page",noToolbar:!0,messagesContent:!0,children:[t.jsxs(L,{className:"messages-navbar",backLink:!0,children:[t.jsx($,{children:t.jsx("div",{className:"",children:u("搜索")})}),t.jsx(N,{inner:!1,children:t.jsx(P,{searchContainer:".contacts-list",placeholder:u("输入关键字"),searchIn:".item-inner",outline:!1,disableButtonText:u("取消"),onChange:e=>j(e.target.value)})})]}),t.jsx(w,{className:"p-0",children:t.jsx(T,{contactsList:!0,noChevron:!0,mediaList:!0,dividers:!0,children:v.map(e=>t.jsxs(k,{link:!0,onClick:async()=>{f.init({dialogId:(e==null?void 0:e.dialog_id)??0,receiverId:(e==null?void 0:e.user_id)??(e==null?void 0:e.group_id)??0,isGroup:!!(e!=null&&e.group_id),receiverInfo:e}),h==null||h.navigate(`/message/${(e==null?void 0:e.user_id)??(e==null?void 0:e.group_id)}/${e==null?void 0:e.dialog_id}/?is_group=${e!=null&&e.user_id?"false":"true"}&dialog_name=${e==null?void 0:e.dialog_name}`)},children:[t.jsx(E,{slot:"media",size:50,src:`${e==null?void 0:e.dialog_avatar}`}),t.jsx("span",{slot:"title",children:e==null?void 0:e.dialog_name}),t.jsxs("span",{slot:"footer",children:[`发现「${e.msgs.length}」条消息`,S(e)]})]},e==null?void 0:e.dialog_id))})})]})};export{O as default};
//# sourceMappingURL=Search-ZA6utDAO.js.map

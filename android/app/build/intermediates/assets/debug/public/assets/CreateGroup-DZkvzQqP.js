import{R as N,r as x,a0 as P,j as e,q as O,ai as E,P as L,N as S,Z as T,b as R,I as q,_ as A,$ as n,C as I,d as G,S as B,L as v,aj as F,o as g,m as M,ak as X,f as u,ah as _,X as w,al as Z}from"./index-D6xPw8DV.js";import{C as b,a as C}from"./card-BzxAURFv.js";import{S as $}from"./searchbar-DXQBL9hB.js";function k(){return k=Object.assign||function(r){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var t in c)Object.prototype.hasOwnProperty.call(c,t)&&(r[t]=c[t])}return r},k.apply(this,arguments)}function U(r,o){if(r==null)return{};var c={},t=Object.keys(r),d,i;for(i=0;i<t.length;i++)d=t[i],!(o.indexOf(d)>=0)&&(c[d]=r[d]);return c}function V(r){r.children;var o=U(r,["children"]);return N.createElement("svg",k({fill:"currentcolor",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 56 56"},o),N.createElement("path",{d:"M 10.0234 43.0234 C 9.2266 43.8203 9.2031 45.1797 10.0234 45.9766 C 10.8438 46.7734 12.1797 46.7734 13.0000 45.9766 L 28.0000 30.9766 L 43.0000 45.9766 C 43.7969 46.7734 45.1563 46.7969 45.9766 45.9766 C 46.7734 45.1562 46.7734 43.8203 45.9766 43.0234 L 30.9531 28.0000 L 45.9766 13.0000 C 46.7734 12.2031 46.7969 10.8437 45.9766 10.0469 C 45.1328 9.2266 43.7969 9.2266 43.0000 10.0469 L 28.0000 25.0469 L 13.0000 10.0469 C 12.1797 9.2266 10.8203 9.2031 10.0234 10.0469 C 9.2266 10.8672 9.2266 12.2031 10.0234 13.0000 L 25.0234 28.0000 Z"}))}const W=({completed:r,defaults:o,opened:c,setOpened:t})=>{const[d,i]=x.useState({}),m=(s,l)=>{var f;return(f=l||o)==null?void 0:f.some(y=>(y==null?void 0:y.dialog_id)===(s==null?void 0:s.dialog_id))},j=async()=>{const s=M.getState().cacheContacts;s&&i(X(s)),h(o||[])};P(async()=>{await j()},()=>{},[c]);const[p,h]=x.useState([]),a=s=>{m(s,p)?h(p.filter(l=>(l==null?void 0:l.dialog_id)!==(s==null?void 0:s.dialog_id))):h([...p,s])};return e.jsx(O,{className:"contact-popup",onPopupOpen:async()=>await j(),onPopupClosed:()=>{i([]),h([]),t&&t(!1)},opened:c,children:e.jsx(E,{children:e.jsxs(L,{className:"bg-bgTertiary",children:[e.jsxs(S,{className:"hidden-navbar-bg bg-bgPrimary coss_contact_navbar",children:[e.jsx(T,{children:e.jsx(R,{popupClose:!0,children:e.jsx(q,{icon:"icon-back"})})}),e.jsx(A,{children:n("选择联系人")}),e.jsx(I,{children:e.jsx(G,{popupClose:!0,onClick:()=>r(p),children:n("完成")})}),e.jsx(B,{inner:!1,children:e.jsx($,{searchContainer:".contacts-list",placeholder:n("搜索联系人"),searchIn:".item-title",outline:!1,disableButtonText:n("取消")})})]}),e.jsx(v,{strong:!0,noChevron:!0,dividers:!0,contactsList:!0,children:Object.keys(d).map(s=>e.jsxs(F,{children:[e.jsx(g,{groupTitle:!0,title:s}),d[s].map((l,f)=>e.jsx(g,{title:l==null?void 0:l.nickname,checkbox:!0,checkboxIcon:"end",onChange:()=>a(l),defaultChecked:m(l),children:e.jsx("div",{slot:"media",className:"w-10 h-10 ",children:e.jsx("img",{src:l==null?void 0:l.avatar,className:"w-full h-full object-cover rounded-full",alt:""})})},f))]},s))})]})})})},J=({f7route:r,f7router:o})=>{var h;const c=x.useMemo(()=>{var a;return(a=r==null?void 0:r.query)==null?void 0:a.id},[(h=r==null?void 0:r.query)==null?void 0:h.id]),[t,d]=x.useState({name:"",avatar:"https://cdn.framework7.io/placeholder/nature-1000x600-3.jpg",type:0,max_members_limit:500,member:[]}),[i,m]=x.useState([]),j=async()=>{try{u.dialog.preloader("创建中...");const{code:a,msg:s}=await _.createGroupApi(t);if(a!==200){u.dialog.alert(s,n("新建群聊失败"));return}w(),o.back()}catch(a){u.dialog.alert(n((a==null?void 0:a.message)||"群聊创建失败"))}finally{u.dialog.close()}},p=async()=>{try{u.dialog.preloader("修改中...");const{code:a,msg:s}=await _.groupUpdateApi({...Z(t,["name","avatar","type"]),group_id:parseInt(c)});if(a!==200){u.dialog.alert(n(s||"编辑群聊失败"));return}a===200&&o.back(),w()}catch(a){u.dialog.alert(n((a==null?void 0:a.message)||"编辑群聊失败"))}finally{u.dialog.close()}};return x.useEffect(()=>{if(!i.length)return;const a=i.map(s=>s.user_id);d({...t,member:a})},[i]),e.jsxs(L,{noToolbar:!0,className:"relative",children:[e.jsx(S,{backLink:!0,title:n(c?"修改群聊信息":"新建群聊"),className:"hidden-navbar-bg",children:e.jsx(I,{children:e.jsx(G,{large:!0,disabled:!t.name,onClick:c?p:j,children:n("完成")})})}),e.jsx(b,{className:"coss_card_title pt-6",children:e.jsxs(C,{className:"flex justify-center flex-col items-center",children:[e.jsx("img",{className:"w-20 h-20 rounded-full mb-5",src:t.avatar}),e.jsx("input",{className:"text-center bg-transparent",placeholder:n("请输入群名称"),name:"name",value:t.name,onChange:a=>d({...t,name:a.target.value})})]})}),e.jsx(b,{title:n("群类型"),className:"coss_card_title",children:e.jsx(C,{children:e.jsxs(v,{strongIos:!0,dividersIos:!0,children:[e.jsx(g,{radio:!0,radioIcon:"end",defaultChecked:t.type==1,name:"type",value:"1",onChange:a=>d({...t,type:Number(a.target.value)}),children:e.jsx("span",{slot:"title",className:"text-base",children:n("公开")})}),e.jsx(g,{radio:!0,radioIcon:"end",defaultChecked:t.type==0,name:"type",value:"0",onChange:a=>d({...t,type:Number(a.target.value)}),children:e.jsx("span",{slot:"title",className:"text-base",children:n("私有")})})]})})}),!c&&e.jsx(b,{title:n("群成员"),className:"coss_card_title",children:e.jsx(C,{padding:!1,children:e.jsx(v,{children:e.jsx(g,{link:!0,popupOpen:".contact-popup",children:n("从好友列表选取")})})})}),e.jsx(b,{title:i.length&&n("已选择"),className:"coss_card_title",children:e.jsx(C,{padding:!1,children:e.jsx(v,{children:i.map((a,s)=>e.jsxs(g,{link:!0,noChevron:!0,title:a==null?void 0:a.nickname,children:[e.jsx("img",{slot:"media",src:a==null?void 0:a.avatar,alt:"",className:"w-12 h-12 rounded-full object-cover"}),e.jsx(V,{slot:"after",onClick:()=>m(i.filter(l=>l!==a))})]},s))})})}),e.jsx(W,{completed:m,defaults:i})]})};export{J as default};
//# sourceMappingURL=CreateGroup-DZkvzQqP.js.map

{"version":3,"file":"PersonalDetail-0UUSgNUv.js","sources":["../../src/components/Remark/Remark.tsx","../../src/pages/PersonalDetail/PersonalDetail.tsx"],"sourcesContent":["import { $t } from '@/shared'\nimport { Icon, Link, List, ListInput, NavLeft, NavRight, NavTitle, Navbar, Page, Popup } from 'framework7-react'\n\nimport './Remark.scss'\nimport { useState } from 'react'\n\ninterface RemarkProps {\n\ttitle?: string\n\topened: boolean\n\tonPopupClosed: (value: boolean) => void\n\tsend: (text: string) => Promise<void>\n}\n\nconst Remark: React.FC<RemarkProps> = ({ opened, onPopupClosed, title, send }) => {\n\tconst [text, setText] = useState<string>('')\n\n\treturn (\n\t\t<Popup opened={opened} onPopupClosed={() => onPopupClosed(false)}>\n\t\t\t<Page className=\"bg-bgTertiary\">\n\t\t\t\t<Navbar className=\"hidden-navbar-bg bg-bgPrimary coss_remark\">\n\t\t\t\t\t<NavLeft>\n\t\t\t\t\t\t<Link popupClose>\n\t\t\t\t\t\t\t<Icon icon=\"icon-back\"></Icon>\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t</NavLeft>\n\t\t\t\t\t<NavTitle>{title || $t('添加好友')}</NavTitle>\n\t\t\t\t\t<NavRight>\n\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\tawait send(text)\n\t\t\t\t\t\t\t\tonPopupClosed(false)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{$t('发送')}\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t</NavRight>\n\t\t\t\t</Navbar>\n\n\t\t\t\t<List strongIos outlineIos dividersIos form formStoreData className=\"bg-bgPrimary\">\n\t\t\t\t\t<ListInput\n\t\t\t\t\t\tname=\"name\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tonChange={(e) => setText(e.target.value)}\n\t\t\t\t\t\tclearButton\n\t\t\t\t\t\tautofocus\n\t\t\t\t\t\tplaceholder={$t('请输入备注信息')}\n\t\t\t\t\t/>\n\t\t\t\t</List>\n\t\t\t</Page>\n\t\t</Popup>\n\t)\n}\n\nexport default Remark\n","import { List, ListButton, ListItem, Navbar, Page, f7 } from 'framework7-react'\nimport { useRef, useState } from 'react'\nimport { useAsyncEffect } from '@reactuses/core'\n\nimport { $t, toastMessage } from '@/shared'\nimport UserService from '@/api/user'\nimport './PersonalDetail.scss'\nimport Remark from '@/components/Remark/Remark'\nimport RelationService from '@/api/relation'\nimport useLoading from '@/hooks/useLoading.ts'\nimport useCacheStore from '@/stores/cache'\n\nconst PersonalDetail: React.FC<RouterProps> = ({ f7route, f7router }) => {\n\tconst user_id = f7route.params.user_id as string\n\n\tconst pageRef = useRef<{ el: HTMLDivElement | null }>({ el: null })\n\tconst profileAvatarRef = useRef<HTMLDivElement | null>(null)\n\n\tconst [userInfo, setUserInfo] = useState<any>({})\n\n\tconst { watchAsyncFn } = useLoading()\n\n\tconst cacheStore = useCacheStore()\n\n\t// 页面安装时将页面滚动到头像大小的一半\n\tconst onPageInit = () => {\n\t\tconst profileAvatarHeight = profileAvatarRef.current!.offsetHeight\n\t\tpageRef.current.el!.querySelector('.page-content')!.scrollTop = profileAvatarHeight / 2\n\t}\n\n\tuseAsyncEffect(\n\t\tasync () => {\n\t\t\ttry {\n\t\t\t\tconst { data, code } = await watchAsyncFn(() => UserService.getUserInfoApi({ user_id }))\n\t\t\t\tif (code == 200) {\n\t\t\t\t\tsetUserInfo(data)\n\t\t\t\t\t// 已经存在好友关系\n\t\t\t\t\tif (data.preferences) {\n\t\t\t\t\t\tf7router.navigate(`/profile/${user_id}/`, { reloadCurrent: true })\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('获取用户信息失败', error)\n\t\t\t}\n\t\t},\n\t\t() => {},\n\t\t[]\n\t)\n\n\tconst [opened, setOpened] = useState<boolean>(false)\n\tconst addFriend = async (remark: string) => {\n\t\ttry {\n\t\t\tf7.dialog.preloader($t('添加中...'))\n\t\t\tconsole.log('cacheStore.cacheKeyPair?.publicKey ', cacheStore)\n\n\t\t\tconst { code } = await RelationService.addFriendApi({\n\t\t\t\tuser_id,\n\t\t\t\tremark,\n\t\t\t\te2e_public_key: cacheStore.cacheKeyPair?.publicKey ?? ''\n\t\t\t})\n\n\t\t\tif (code !== 200) {\n\t\t\t\ttoastMessage('添加失败')\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\ttoastMessage('添加成功,等待对方同意')\n\t\t} catch (error) {\n\t\t\tconsole.error(error)\n\t\t} finally {\n\t\t\tf7.dialog.close()\n\t\t}\n\t}\n\n\treturn (\n\t\t<Page ref={pageRef} className=\"profile-page bg-bgTertiary\" noToolbar onPageInit={onPageInit}>\n\t\t\t<Navbar title={$t('用户信息')} backLink className=\"bg-bgPrimary hidden-navbar-bg\" />\n\t\t\t<div className=\"profile-avatar-block\" ref={profileAvatarRef}>\n\t\t\t\t<img src={userInfo?.avatar} alt=\"\" />\n\t\t\t</div>\n\t\t\t<div className=\"profile-content\">\n\t\t\t\t<List strong outline dividers mediaList className=\"no-margin-top m-0 mb-3 bg-white\">\n\t\t\t\t\t<ListItem title={userInfo?.nickname}></ListItem>\n\t\t\t\t\t<ListItem subtitle={userInfo?.signature} text={userInfo?.email} />\n\t\t\t\t</List>\n\n\t\t\t\t<List strong outline dividers className=\"bg-white m-0 mb-3\">\n\t\t\t\t\t<ListButton onClick={() => setOpened(true)}>{$t('添加好友')}</ListButton>\n\t\t\t\t</List>\n\t\t\t</div>\n\n\t\t\t<Remark opened={opened} onPopupClosed={setOpened} send={addFriend} />\n\t\t</Page>\n\t)\n}\n\nexport default PersonalDetail\n"],"names":["Remark","opened","onPopupClosed","title","send","text","setText","useState","jsx","Popup","jsxs","Page","Navbar","NavLeft","Link","Icon","NavTitle","$t","NavRight","List","ListInput","e","PersonalDetail","f7route","f7router","user_id","pageRef","useRef","profileAvatarRef","userInfo","setUserInfo","watchAsyncFn","useLoading","cacheStore","useCacheStore","onPageInit","profileAvatarHeight","useAsyncEffect","data","code","UserService","error","setOpened","addFriend","remark","f7","RelationService","_a","toastMessage","ListItem","ListButton"],"mappings":"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"}
import{r as i,j as e,q as S,P as y,N as v,Z as C,b as x,I as R,_ as w,$ as t,C as A,L as p,a as T,H as _,m as K,a0 as U,o as b,U as E,f,V as F,w as j}from"./index-D6xPw8DV.js";import{L as H}from"./list-button-BQBTr0QW.js";const I=({opened:d,onPopupClosed:o,title:r,send:c})=>{const[n,a]=i.useState("");return e.jsx(S,{opened:d,onPopupClosed:()=>o(!1),children:e.jsxs(y,{className:"bg-bgTertiary",children:[e.jsxs(v,{className:"hidden-navbar-bg bg-bgPrimary coss_remark",children:[e.jsx(C,{children:e.jsx(x,{popupClose:!0,children:e.jsx(R,{icon:"icon-back"})})}),e.jsx(w,{children:r||t("添加好友")}),e.jsx(A,{children:e.jsx(x,{onClick:async()=>{await c(n),o(!1)},children:t("发送")})})]}),e.jsx(p,{strongIos:!0,outlineIos:!0,dividersIos:!0,form:!0,formStoreData:!0,className:"bg-bgPrimary",children:e.jsx(T,{name:"name",type:"text",onChange:u=>a(u.target.value),clearButton:!0,autofocus:!0,placeholder:t("请输入备注信息")})})]})})},B=({f7route:d,f7router:o})=>{const r=d.params.user_id,c=i.useRef({el:null}),n=i.useRef(null),[a,u]=i.useState({}),{watchAsyncFn:N}=_(),m=K(),k=()=>{const s=n.current.offsetHeight;c.current.el.querySelector(".page-content").scrollTop=s/2};U(async()=>{try{const{data:s,code:l}=await N(()=>E.getUserInfoApi({user_id:r}));l==200&&(u(s),s.preferences&&o.navigate(`/profile/${r}/`,{reloadCurrent:!0}))}catch(s){console.error("获取用户信息失败",s)}},()=>{},[]);const[L,h]=i.useState(!1),P=async s=>{var l;try{f.dialog.preloader(t("添加中...")),console.log("cacheStore.cacheKeyPair?.publicKey ",m);const{code:g}=await F.addFriendApi({user_id:r,remark:s,e2e_public_key:((l=m.cacheKeyPair)==null?void 0:l.publicKey)??""});if(g!==200){j("添加失败");return}j("添加成功,等待对方同意")}catch(g){console.error(g)}finally{f.dialog.close()}};return e.jsxs(y,{ref:c,className:"profile-page bg-bgTertiary",noToolbar:!0,onPageInit:k,children:[e.jsx(v,{title:t("用户信息"),backLink:!0,className:"bg-bgPrimary hidden-navbar-bg"}),e.jsx("div",{className:"profile-avatar-block",ref:n,children:e.jsx("img",{src:a==null?void 0:a.avatar,alt:""})}),e.jsxs("div",{className:"profile-content",children:[e.jsxs(p,{strong:!0,outline:!0,dividers:!0,mediaList:!0,className:"no-margin-top m-0 mb-3 bg-white",children:[e.jsx(b,{title:a==null?void 0:a.nickname}),e.jsx(b,{subtitle:a==null?void 0:a.signature,text:a==null?void 0:a.email})]}),e.jsx(p,{strong:!0,outline:!0,dividers:!0,className:"bg-white m-0 mb-3",children:e.jsx(H,{onClick:()=>h(!0),children:t("添加好友")})})]}),e.jsx(I,{opened:L,onPopupClosed:h,send:P})]})};export{B as default};
//# sourceMappingURL=PersonalDetail-0UUSgNUv.js.map

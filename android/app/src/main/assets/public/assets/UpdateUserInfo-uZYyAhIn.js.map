{"version":3,"file":"UpdateUserInfo-uZYyAhIn.js","sources":["../../src/pages/Tabs/MyInfo/UserInfo/UpdateUserInfo.tsx"],"sourcesContent":["import { Link, NavRight, Navbar, Page, f7 } from 'framework7-react'\nimport { useState } from 'react'\n\nimport { $t } from '@/shared'\nimport UserService from '@/api/user'\nimport { validPassword } from '@/utils/validate'\nimport { removeAllCookie } from '@/utils/cookie'\nimport useUserStore from '@/stores/user'\nimport CommInput from '@/components/CommInput/CommInput'\n\nconst UpdateUserInfo: React.FC<RouterProps> = ({ f7route, f7router }) => {\n\tconst { default: defaultValue, title } = f7route.query\n\tconst type = f7route.params.type\n\tconst userStore = useUserStore()\n\n\tconst [text, setText] = useState<string>(defaultValue as string)\n\n\tconst [oldPassword, setOldPassword] = useState<string>('')\n\tconst [newPassword, setNewPassword] = useState<string>('')\n\tconst [confirmPassword, setConfirmPassword] = useState<string>('')\n\n\tconst updateUserInfo = async () => {\n\t\ttry {\n\t\t\tf7.dialog.preloader($t('修改中...'))\n\n\t\t\tconst params = { [type as string]: text }\n\t\t\tconst { code, data, msg } = await UserService.updateUserInfoApi(params)\n\t\t\tif (code !== 200) {\n\t\t\t\treturn f7.dialog.alert($t(msg))\n\t\t\t}\n\t\t\tuserStore.update({\n\t\t\t\tuserInfo: {\n\t\t\t\t\t...userStore.userInfo,\n\t\t\t\t\t...data\n\t\t\t\t}\n\t\t\t})\n\t\t\tf7router.back()\n\t\t} catch (error) {\n\t\t\tconsole.error('更新用户信息失败', error)\n\t\t\tf7.dialog.alert($t('更新用户信息失败'))\n\t\t} finally {\n\t\t\tf7.dialog.close()\n\t\t}\n\t}\n\n\tconst updatePassword = async () => {\n\t\tif (!oldPassword || !newPassword || !confirmPassword) return f7.dialog.alert($t('内容不能留空'))\n\t\tif (newPassword !== confirmPassword) return f7.dialog.alert($t('两次密码不一致'))\n\t\tif (!validPassword(newPassword)) return f7.dialog.alert($t('新密码强度太弱'))\n\n\t\ttry {\n\t\t\tf7.dialog.preloader($t('修改中...'))\n\t\t\tconst { code, msg } = await UserService.updatePassWordApi({\n\t\t\t\told_password: oldPassword,\n\t\t\t\tpassword: newPassword,\n\t\t\t\tconfirm_password: confirmPassword\n\t\t\t})\n\t\t\tif (code !== 200) throw new Error(msg)\n\n\t\t\tf7.dialog.alert($t('修改密码成功'), $t('请重新登录'), () => {\n\t\t\t\tremoveAllCookie()\n\t\t\t\tlocation.reload()\n\t\t\t})\n\t\t} catch (error: any) {\n\t\t\tf7.dialog.alert(error.message || $t('修改密码失败'))\n\t\t} finally {\n\t\t\tf7.dialog.close()\n\t\t}\n\t}\n\n\tconst save = async () => {\n\t\tif (type === 'password') return await updatePassword()\n\t\tif (text === defaultValue || !text) return f7.dialog.alert($t('请输入修改内容'))\n\t\tawait updateUserInfo()\n\t}\n\n\treturn (\n\t\t<Page noToolbar>\n\t\t\t<Navbar className=\"hidden-navbar-bg\" backLink title={title}>\n\t\t\t\t<NavRight>\n\t\t\t\t\t<Link onClick={() => save()}>{$t('完成')}</Link>\n\t\t\t\t</NavRight>\n\t\t\t</Navbar>\n\n\t\t\t{type !== 'password' ? (\n\t\t\t\t<div>\n\t\t\t\t\t<CommInput defaultValue={defaultValue} onChange={(value: any) => setText(value)} />\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<div>\n\t\t\t\t\t<CommInput\n\t\t\t\t\t\ttitle={$t('旧密码')}\n\t\t\t\t\t\tplaceholder={$t('请输入旧密码')}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tonChange={(value: any) => setOldPassword(value)}\n\t\t\t\t\t/>\n\t\t\t\t\t<CommInput\n\t\t\t\t\t\ttitle={$t('新密码')}\n\t\t\t\t\t\tplaceholder={$t('请输入新密码')}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tonChange={(value: any) => setNewPassword(value)}\n\t\t\t\t\t/>\n\t\t\t\t\t<CommInput\n\t\t\t\t\t\ttitle={$t('确认密码')}\n\t\t\t\t\t\tplaceholder={$t('请再次输入新密码')}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tonChange={(value: any) => setConfirmPassword(value)}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</Page>\n\t)\n}\n\nexport default UpdateUserInfo\n"],"names":["UpdateUserInfo","f7route","f7router","defaultValue","title","type","userStore","useUserStore","text","setText","useState","oldPassword","setOldPassword","newPassword","setNewPassword","confirmPassword","setConfirmPassword","updateUserInfo","f7","$t","params","code","data","msg","UserService","error","updatePassword","validPassword","removeAllCookie","save","jsxs","Page","jsx","Navbar","NavRight","Link","CommInput","value"],"mappings":"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"}
import{r as y,h as $,i as z,k as B,R as D,j as e,a9 as H,g as X,aa as t,m as Y,a0 as J,P as K,N as Q,_ as W,d as u,$ as a,C as Z,o as w,ab as m,L as ss,p as P,ac as N,ad as L,ae as G,af as S,f as I,V as k,ag as h,ah as O,Y as M,X as V,w as U}from"./index-D6xPw8DV.js";function T(){return T=Object.assign?Object.assign.bind():function(n){for(var d=1;d<arguments.length;d++){var o=arguments[d];for(var p in o)Object.prototype.hasOwnProperty.call(o,p)&&(n[p]=o[p])}return n},T.apply(this,arguments)}const q=y.forwardRef((n,d)=>{const{className:o,id:p,style:g,children:f,raised:E,raisedIos:_,raisedMd:v,round:F,roundIos:s,roundMd:r,strong:l,strongIos:c,strongMd:i,tag:x="div"}=n,R=$(n),j=y.useRef(null);y.useImperativeHandle(d,()=>({el:j.current}));const A=z(o,{segmented:!0,"segmented-raised":E,"segmented-raised-ios":_,"segmented-raised-md":v,"segmented-round":F,"segmented-round-ios":s,"segmented-round-md":r,"segmented-strong":l,"segmented-strong-ios":c,"segmented-strong-md":i},B(n)),C=x;return D.createElement(C,T({id:p,style:g,className:A,ref:j},R),f,(l||c||i)&&D.createElement("span",{className:"segmented-highlight"}))});q.displayName="f7-segmented";const es=q,rs=({tips:n="暂无数据",...d})=>e.jsx("div",{className:"h-full text-gray-400 flex justify-center items-center",...d,children:n}),b=H(X)||"",ns=()=>{const[n,d]=y.useState(t.FRIEND),o=Y(),p=y.useMemo(()=>n===t.FRIEND?o.friendApply:o.groupApply,[n,o.friendApply,o.groupApply]);J(async()=>{await S()},()=>{},[n]);const g=async(s,r=0)=>{try{I.dialog.preloader(a("处理中..."));const l=r===N.ACCEPT;let c="";l&&(c="");const{code:i,msg:x}=n===t.FRIEND?await k.manageFriendApplyApi({request_id:s.id,action:r,e2e_public_key:c}):(s==null?void 0:s.status)===h.INVITE_RECEIVER?await O.manageGroupRequestApi({group_id:s.group_id,action:r,id:s.id}):await O.manageGroupRequestAdminApi({group_id:s.group_id,action:r,id:s.id});if(i!==200){I.dialog.alert(a(x));return}await S(),M(),V()}catch(l){console.error("处理好友请求失败",l),I.dialog.alert(a("处理好友请求失败"))}finally{I.dialog.close()}},f=s=>({0:"待验证",1:"已通过",2:"已拒绝",3:"待验证",4:"邀请接收者"})[s],E=({status:s,sender_id:r})=>n===t.FRIEND?s===h.PENDING&&r!==b:s===h.PENDING||s===h.INVITE_RECEIVER,_=({status:s,sender_info:r={}})=>n===t.FRIEND?r.user_id===b:s!==h.ACCEPT?s===h.INVITE_SENDER:(r==null?void 0:r.user_id)===b,v=async s=>{try{const r=n===t.FRIEND,l=s.id,{code:c,msg:i}=r?await k.deleteFriendApplyApi({id:l}):await k.deleteGroupApplyApi({id:l});if(U(c===200?"删除成功":i),c!==200)return;await S()}catch(r){console.log(r),U("删除失败")}},F=async s=>{await g(s,N.ACCEPT),M(),V()};return e.jsxs(K,{noToolbar:!0,className:"bg-bgTertiary",children:[e.jsxs(Q,{backLink:!0,className:"coss_applylist_navbar bg-bgPrimary hidden-navbar-bg",children:[e.jsx(W,{children:e.jsxs(es,{strong:!0,children:[e.jsx(u,{active:n===t.FRIEND,onClick:()=>d(t.FRIEND),children:a("好友申请")}),e.jsx(u,{active:n===t.GROUP,onClick:()=>d(t.GROUP),children:a("群聊申请")})]})}),e.jsx(Z,{children:e.jsx(w,{link:"/add_friend/",popoverClose:!0,className:"coss_dialog_list",children:e.jsx(m,{className:"w-7 h-7"})})})]}),p.length<=0?e.jsx(rs,{}):e.jsx(ss,{strongIos:!0,className:"m-0",mediaList:!0,children:p.map((s,r)=>{var l,c,i,x,R,j,A,C;return n===t.FRIEND?e.jsxs(w,{text:a((s==null?void 0:s.remark)||"对方没有留言"),swipeout:!0,children:[e.jsx("div",{slot:"media",className:"w-12 h-12",children:e.jsx(P,{size:50,src:(l=s==null?void 0:s.receiver_info)==null?void 0:l.user_avatar})}),e.jsx("div",{slot:"title",children:e.jsx("span",{children:a((c=s==null?void 0:s.receiver_info)==null?void 0:c.user_name)})}),e.jsx("div",{slot:"content",className:"pr-2 flex",children:E(s)?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"text-sm text-red-500",onClick:()=>g(s,N.REFUSE),children:"拒绝"}),e.jsx(u,{className:"text-sm text-primary",onClick:()=>F(s),children:"同意"})]}):e.jsx(u,{className:"text-sm text-gray-500",onClick:()=>{},children:f(s.status)})}),e.jsx(L,{right:!0,children:e.jsx(G,{close:!0,color:"red",onClick:()=>v(s),children:a("删除")})})]},r):e.jsxs(w,{text:a((s==null?void 0:s.remark)||"对方没有留言"),swipeout:!0,children:[e.jsx("div",{slot:"media",className:"w-12 h-12",children:e.jsx(P,{size:50,src:(i=s==null?void 0:s.receiver_info)==null?void 0:i.user_avatar})}),e.jsxs("div",{slot:"title",children:[s!=null&&s.sender_info&&(s!=null&&s.receiver_info)?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a(_(s)?"你":(x=s==null?void 0:s.sender_info)==null?void 0:x.user_name)}),e.jsx("span",{children:a("邀请")}),e.jsx("span",{children:a(_(s)?(R=s==null?void 0:s.receiver_info)==null?void 0:R.user_name:"你")}),e.jsx("span",{children:a("加入")})]}):s!=null&&s.sender_info?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a((A=s==null?void 0:s.sender_info)==null?void 0:A.user_name)}),e.jsx("span",{children:a("邀请")}),e.jsx("span",{children:a((C=s==null?void 0:s.receiver_info)==null?void 0:C.user_name)}),e.jsx("span",{children:a("加入")})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a((j=s==null?void 0:s.receiver_info)==null?void 0:j.user_name)}),e.jsx("span",{children:a("申请加入")})]}),e.jsx("span",{children:a(s==null?void 0:s.group_name)})]}),e.jsx("div",{slot:"content",className:"pr-2 flex",children:E(s)?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"text-sm text-red-500",onClick:()=>g(s,N.REFUSE),children:"拒绝"}),e.jsx(u,{className:"text-sm text-primary",onClick:()=>g(s,N.ACCEPT),children:"同意"})]}):e.jsx(u,{className:"text-sm text-gray-500",onClick:()=>{},children:f(s.status)})}),e.jsx(L,{right:!0,children:e.jsx(G,{close:!0,color:"red",onClick:()=>v(s),children:a("删除")})})]},r)})})]})};export{ns as default};
//# sourceMappingURL=ApplyList-CIkIifrb.js.map

import{a9 as O,g as T,r as c,j as s,P as A,N as F,am as d,C as P,b as y,S as H,L as g,o as h,f as a,ah as f,V as W}from"./index-D6xPw8DV.js";import{S as D}from"./searchbar-DXQBL9hB.js";const V=n=>{console.log(n);const r=n.list_type,b=()=>({show:"成员列表",plus:"选择联系人",minus:"聊天成员"})[r],x=O(T)||"",[j,v]=c.useState(null),[o,k]=c.useState([]),E=async()=>{const{code:e,data:t}=await f.groupMemberApi({group_id:n.group_id});if(e===200){const i=t==null?void 0:t.find(u=>u.user_id===x).identity;i&&v(i),k(t)}},[m,_]=c.useState([]),S=async()=>{const{code:e,data:t}=await W.getFriendListApi();if(e===200){const i=[];for(const u in t)if(Object.hasOwnProperty.call(t,u)){const w=t[u]||[];for(const B of w)i.push({...B,group:u})}_(i)}},L=c.useMemo(()=>m.filter(e=>!(o!=null&&o.find(t=>t.user_id===e.user_id))),[m,o]),C=c.useMemo(()=>o.filter(e=>e.identity!==2&&e.user_id!==x&&e.identity<j),[o]),R=async()=>{a.dialog.preloader("加载中..."),await E(),await S(),a.dialog.close()};c.useEffect(()=>{R()},[]);const[l,p]=c.useState([]),M=(e,t)=>{e.target.checked?l.indexOf(t)===-1&&p([...l,t]):p(l.filter(i=>i!==t))},N=async()=>{try{a.dialog.preloader("请稍候...");const{code:e,msg:t}=await f.groupInviteApi({group_id:parseInt(n.group_id),member:l});e===200&&n.f7router.back(),e!==200&&a.dialog.alert(t)}catch(e){a.dialog.alert(e.message)}finally{a.dialog.close()}},I=async()=>{a.dialog.confirm("移除成员","确定移除吗？",async()=>{try{a.dialog.preloader("请稍候...");const{code:e,msg:t}=await f.groupRemoveApi({group_id:parseInt(n.group_id),member:l});e===200&&n.f7router.back(),e!==200&&a.dialog.alert(t)}catch(e){a.dialog.alert(e.message)}finally{a.dialog.close()}})};return s.jsxs(A,{noToolbar:!0,children:[s.jsxs(F,{title:r===d.MEMBERSHOW?b():"",backLink:!0,className:"hidden-navbar-bg",children:[s.jsxs(P,{children:[r===d.NOTMEMBER&&s.jsx(y,{onClick:N,children:"邀请"}),r===d.MEMBER&&s.jsx(y,{color:"red",onClick:I,children:"删除"})]}),s.jsx(H,{children:s.jsx(D,{searchContainer:".contacts-list",disableButton:!1})})]}),r===d.NOTMEMBER&&s.jsx(g,{contactsList:!0,noChevron:!0,dividers:!0,className:"member-list",children:L.map((e,t)=>s.jsx(h,{checkbox:!0,checkboxIcon:"end",media:e.avatar,title:e.nickname,subtitle:e.email,onChange:i=>M(i,e.user_id)},t))}),r===d.MEMBER&&s.jsx(g,{contactsList:!0,noChevron:!0,dividers:!0,className:"member-list",children:C.map((e,t)=>s.jsx(h,{checkbox:!0,checkboxIcon:"end",media:e.avatar,title:e.nickname,subtitle:e.email,onChange:i=>M(i,e.user_id)},t))}),r===d.MEMBERSHOW&&s.jsx(g,{contactsList:!0,noChevron:!0,dividers:!0,className:"member-list",children:o.map((e,t)=>s.jsx(h,{media:e.avatar,title:e.nickname,footer:e.email,children:s.jsxs("div",{slot:"after",className:"text-sm",children:[e.identity===2&&s.jsx("span",{children:"群主"}),e.identity===1&&s.jsx("span",{children:"管理员"}),e.identity===0&&s.jsx("span",{children:"成员"})]})},t))})]})};export{V as default};
//# sourceMappingURL=MemberList-BxvoaOSe.js.map

import{aa as O,e as T,r as o,j as s,P,N as A,ai as c,o as F,a as M,S as H,p as W,L as g,l as h,f as i,ae as m,H as D}from"./index-Bku3qZqe.js";const U=n=>{console.log(n);const r=n.list_type,b=()=>({show:"成员列表",plus:"选择联系人",minus:"聊天成员"})[r],f=O(T)||"",[j,v]=o.useState(null),[d,k]=o.useState([]),E=async()=>{const{code:e,data:t}=await m.groupMemberApi({group_id:n.group_id});if(e===200){const a=t.find(u=>u.user_id===f).identity;a&&v(a),k(t)}},[x,_]=o.useState([]),S=async()=>{const{code:e,data:t}=await D.getFriendListApi();if(e===200){const a=[];for(const u in t)if(Object.hasOwnProperty.call(t,u)){const w=t[u]||[];for(const B of w)a.push({...B,group:u})}_(a)}},L=o.useMemo(()=>x.filter(e=>!d.find(t=>t.user_id===e.user_id)),[x,d]),R=o.useMemo(()=>d.filter(e=>e.identity!==2&&e.user_id!==f&&e.identity<j),[d]),C=async()=>{i.dialog.preloader("加载中..."),await E(),await S(),i.dialog.close()};o.useEffect(()=>{C()},[]);const[l,p]=o.useState([]),y=(e,t)=>{e.target.checked?l.indexOf(t)===-1&&p([...l,t]):p(l.filter(a=>a!==t))},N=async()=>{try{i.dialog.preloader("请稍候...");const{code:e,msg:t}=await m.groupInviteApi({group_id:parseInt(n.group_id),member:l});e===200&&n.f7router.back(),e!==200&&i.dialog.alert(t)}catch(e){i.dialog.alert(e.message)}finally{i.dialog.close()}},I=async()=>{i.dialog.confirm("移除成员","确定移除吗？",async()=>{try{i.dialog.preloader("请稍候...");const{code:e,msg:t}=await m.groupRemoveApi({group_id:parseInt(n.group_id),member:l});e===200&&n.f7router.back(),e!==200&&i.dialog.alert(t)}catch(e){i.dialog.alert(e.message)}finally{i.dialog.close()}})};return s.jsxs(P,{noToolbar:!0,children:[s.jsxs(A,{title:r===c.MEMBERSHOW?b():"",backLink:!0,className:"bg-bgPrimary hidden-navbar-bg",children:[s.jsxs(F,{children:[r===c.NOTMEMBER&&s.jsx(M,{onClick:N,children:"邀请"}),r===c.MEMBER&&s.jsx(M,{color:"red",onClick:I,children:"删除"})]}),s.jsx(H,{children:s.jsx(W,{searchContainer:".contacts-list",disableButton:!1})})]}),r===c.NOTMEMBER&&s.jsx(g,{contactsList:!0,noChevron:!0,dividers:!0,className:"member-list",children:L.map((e,t)=>s.jsx(h,{checkbox:!0,checkboxIcon:"end",media:e.avatar,title:e.nickname,subtitle:e.email,onChange:a=>y(a,e.user_id)},t))}),r===c.MEMBER&&s.jsx(g,{contactsList:!0,noChevron:!0,dividers:!0,className:"member-list",children:R.map((e,t)=>s.jsx(h,{checkbox:!0,checkboxIcon:"end",media:e.avatar,title:e.nickname,subtitle:e.email,onChange:a=>y(a,e.user_id)},t))}),r===c.MEMBERSHOW&&s.jsx(g,{contactsList:!0,noChevron:!0,dividers:!0,className:"member-list",children:d.map((e,t)=>s.jsx(h,{media:e.avatar,title:e.nickname,footer:e.email,children:s.jsxs("div",{slot:"after",className:"text-sm",children:[e.identity===2&&s.jsx("span",{children:"群主"}),e.identity===1&&s.jsx("span",{children:"管理员"}),e.identity===0&&s.jsx("span",{children:"成员"})]})},t))})]})};export{U as default};
